<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>BFA IPTV ‚Äî Admin</title>

<!-- PWA (optional) -->
<link rel="manifest" href="/IPTV-/manifest.webmanifest"/>
<meta name="theme-color" content="#ff9500"/>
<link rel="icon" sizes="192x192" href="/IPTV-/icons/icon-192.png"/>
<link rel="icon" sizes="512x512" href="/IPTV-/icons/icon-512.png"/>
<link rel="apple-touch-icon" href="/IPTV-/icons/icon-192.png"/>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #f7f9fc;
    --fg: #2d3748;
    --muted: #718096;
    --tile: #ffffff;
    --panel: #ffffff;
    --border: #e2e8f0;
    --accent: #ff9500;
    --accent-light: #ffedcc;
    --ok: #38a169;
    --err: #e53e3e;
    --r: 16px;
    --g: 16px;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  * {
    box-sizing: border-box;
    transition: all 0.2s ease;
  }

  html, body {
    height: 100%;
    scroll-behavior: smooth;
  }

  body {
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    line-height: 1.5;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  /* Shell */
  .shell {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 24px;
    padding: 16px;
    background: var(--tile);
    border-radius: 20px;
    box-shadow: var(--shadow);
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo {
    width: 42px;
    height: 42px;
    border-radius: 12px;
    background: var(--accent-light) center/cover no-repeat;
    border: 2px solid var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    color: var(--accent);
    font-size: 18px;
  }

  .title {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    letter-spacing: -0.5px;
    font-size: 22px;
    background: linear-gradient(90deg, var(--accent), #ff6600);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .btn {
    height: 40px;
    padding: 0 18px;
    border-radius: 12px;
    border: none;
    background: var(--tile);
    color: var(--fg);
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    box-shadow: var(--shadow);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
  }

  .btn.orange {
    background: var(--accent);
    color: white;
  }

  .muted {
    color: var(--muted);
    font-size: 13px;
  }

  /* Page carousel (swipe) */
  .viewport {
    position: relative;
    overflow: hidden;
    border-radius: 20px;
    background: var(--panel);
    box-shadow: var(--shadow);
    margin-bottom: 16px;
  }

  .pages {
    display: flex;
    transition: transform 0.3s ease;
    will-change: transform;
  }

  .page {
    min-width: 100%;
    padding: 20px;
  }

  .p-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border);
  }

  .p-title {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    font-size: 24px;
    letter-spacing: -0.5px;
    color: #2d3748;
  }

  .p-sub {
    font-size: 14px;
    color: var(--muted);
    margin-top: 4px;
  }

  /* Bottom nav */
  .nav {
    display: flex;
    gap: 8px;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    padding: 12px;
    background: var(--tile);
    border-radius: 18px;
    box-shadow: var(--shadow);
  }

  .tab {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 12px;
    border-radius: 14px;
    background: transparent;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
  }

  .tab:hover {
    background: var(--accent-light);
  }

  .tab.active {
    background: var(--accent);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
  }

  .tab small {
    font-size: 11px;
  }

  /* Bento cards (square bubbles) */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--g);
  }

  .bubble {
    background: var(--tile);
    border: 1px solid var(--border);
    border-radius: var(--r);
    padding: 20px;
    position: relative;
    box-shadow: var(--shadow);
  }

  .bubble:hover {
    transform: translateY(-4px);
    border-color: var(--accent);
    box-shadow: var(--shadow-hover);
  }

  .b-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .b-title {
    font-weight: 700;
    font-size: 18px;
    color: #2d3748;
  }

  .b-badges {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
    background: var(--accent-light);
    color: var(--accent);
  }

  .b-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 16px;
  }

  .b-expand {
    margin-top: 16px;
    display: none;
    border-top: 1px dashed var(--border);
    padding-top: 16px;
  }

  .bubble.expanded .b-expand {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  .btn-sm {
    padding: 8px 14px;
    border-radius: 10px;
    border: none;
    background: var(--bg);
    color: var(--fg);
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .btn-sm:hover {
    transform: translateY(-1px);
  }

  .btn-sm.orange {
    background: var(--accent);
    color: white;
  }

  .btn-sm.danger {
    background: var(--err);
    color: white;
  }

  /* Inputs */
  .label {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 8px;
    font-weight: 600;
  }

  .input, .select, .textarea {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--fg);
    outline: none;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
  }

  .input:focus, .select:focus, .textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(255, 149, 0, 0.2);
  }

  .textarea {
    min-height: 100px;
    resize: vertical;
  }

  .row, .row2, .row3 {
    display: grid;
    gap: 12px;
    margin: 12px 0;
  }

  .row {
    grid-template-columns: 1fr auto;
  }

  .row2 {
    grid-template-columns: 1fr 1fr;
  }

  .row3 {
    grid-template-columns: 1fr 1fr 1fr;
  }

  @media (max-width: 760px) {
    .row, .row2, .row3 {
      grid-template-columns: 1fr;
    }
  }

  .list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 10px;
  }

  .item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 14px;
    border: 1px solid var(--border);
    border-radius: 14px;
    background: var(--tile);
    flex-wrap: wrap;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
  }

  .item:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  }

  .tag {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    background: var(--bg);
    color: var(--muted);
  }

  .online {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 600;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .ok {
    background: var(--ok);
  }

  .err {
    background: var(--err);
  }

  .vol {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .vol input[type="range"] {
    width: 140px;
    height: 6px;
    border-radius: 3px;
    background: var(--bg);
    outline: none;
    -webkit-appearance: none;
  }

  .vol input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  @media (max-width: 560px) {
    .vol input[type="range"] {
      width: 100%;
    }
  }

  /* Calendar */
  .cal-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 12px 0;
  }

  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
  }

  .dow {
    font-size: 12px;
    color: var(--muted);
    text-align: center;
    font-weight: 600;
    padding: 8px 0;
  }

  .day {
    height: 80px;
    padding: 8px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--tile);
    display: flex;
    flex-direction: column;
    gap: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .day:hover {
    background: var(--accent-light);
    border-color: var(--accent);
  }

  .day.today {
    outline: 2px solid var(--accent);
    background: var(--accent-light);
  }

  .day .n {
    font-weight: 700;
    font-size: 15px;
    text-align: center;
  }

  .pill {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid var(--border);
    font-size: 10px;
    color: var(--muted);
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    background: var(--bg);
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--accent);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    font-weight: 700;
    opacity: 0;
    transition: opacity 0.3s, transform 0.3s;
    pointer-events: none;
    z-index: 1000;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-10px);
  }

  .toast.err {
    background: var(--err);
  }

  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  /* Loading animation */
  .loading {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Welcome message */
  .welcome {
    background: linear-gradient(135deg, #ff9500, #ff6b00);
    color: white;
    padding: 16px 20px;
    border-radius: 16px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .welcome-icon {
    font-size: 24px;
  }

  .welcome-text {
    flex: 1;
  }

  .welcome-title {
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 4px;
  }

  .welcome-sub {
    font-size: 14px;
    opacity: 0.9;
  }
</style>
</head>
<body>
<div class="shell">
  <div class="top">
    <div class="brand">
      <div id="brandLogo" class="logo">BFA</div>
      <div class="title">BFA IPTV ‚Äî Admin</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <span id="who" class="muted"></span>
      <button id="reloadBtn" class="btn">üîÑ Reload</button>
      <button id="signOutBtn" class="btn orange">üö™ Sign out</button>
    </div>
  </div>

  <!-- Welcome message -->
  <div id="welcomeMsg" class="welcome" style="display:none;">
    <div class="welcome-icon">üëã</div>
    <div class="welcome-text">
      <div class="welcome-title">Welcome back!</div>
      <div class="welcome-sub">You're managing IPTV displays and users.</div>
    </div>
  </div>

  <!-- Auth pane (shown when no admin) -->
  <div id="authPane" class="viewport" style="display:none;">
    <div class="page" style="min-height:280px">
      <div class="p-head">
        <div>
          <div class="p-title">Admin Sign In</div>
          <div class="p-sub">Access your admin dashboard</div>
        </div>
        <div>üîí</div>
      </div>
      <div class="grid">
        <div class="bubble expanded">
          <div class="b-head"><div class="b-title">Credentials</div></div>
          <div class="b-expand">
            <div class="row2">
              <div><div class="label">Email</div><input id="email" class="input" placeholder="you@company.com"/></div>
              <div><div class="label">Password</div><input id="password" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div>
            </div>
            <div class="b-actions">
              <button id="loginBtn" class="btn-sm orange">üëâ Sign in</button>
              <button id="resetBtn" class="btn-sm">üìß Send reset link</button>
            </div>
            <div class="muted">Your user must have <b>role: "admin"</b> in <code>/user/{uid}</code>.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- App -->
  <div id="app" style="display:none">
    <div class="viewport" id="viewport">
      <div class="pages" id="pages" style="transform:translateX(0%)">
        <!-- PAGE 0 ‚Äî DEALERS -->
        <section class="page" id="pgDealers">
          <div class="p-head">
            <div>
              <div class="p-title">Dealerships üè¢</div>
              <div class="p-sub">Create, rename (migrate), delete</div>
            </div>
            <div>üè¢</div>
          </div>

          <div class="grid" id="dealerGrid">
            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Add dealership</div></div>
              <div class="b-expand">
                <div class="row">
                  <div>
                    <div class="label">Dealership name</div>
                    <input id="dealerName" class="input" placeholder="e.g., Kia Yorkdale"/>
                  </div>
                  <div style="display:flex;align-items:end"><button id="addDealerBtn" class="btn-sm orange">‚ûï Add</button></div>
                </div>
                <div class="muted">Creates <code>/dealership/{id}</code> and <code>/dealershipPublic/{id}</code>.</div>
              </div>
            </div>

            <div class="bubble expanded">
              <div class="b-head">
                <div class="b-title">All dealerships</div>
                <div class="b-badges"><span class="badge" id="dealerCount">0</span></div>
              </div>
              <div class="b-expand">
                <ul id="dealerList" class="list"></ul>
                <div id="dealerEmpty" class="muted" style="padding:10px 0;text-align:center">No dealerships yet. Add one to get started! üöÄ</div>
              </div>
            </div>
          </div>
        </section>

        <!-- PAGE 1 ‚Äî DISPLAYS -->
        <section class="page" id="pgDisplays">
          <div class="p-head">
            <div><div class="p-title">Displays üì∫</div><div class="p-sub">Live controls by dealership</div></div>
            <div>üì∫</div>
          </div>

          <div class="grid">
            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Pick dealership</div></div>
              <div class="b-expand">
                <div class="row3">
                  <div>
                    <div class="label">Dealership</div>
                    <select id="dispDealer" class="select"><option value="">Select‚Ä¶</option></select>
                  </div>
                  <div>
                    <div class="label">Optional display ID</div>
                    <input id="newDisplayId" class="input" placeholder="Auto if empty (e.g., KY-002)"/>
                  </div>
                  <div style="display:flex;align-items:end"><button id="addDisplayBtn" class="btn-sm orange">üì∫ Add TV</button></div>
                </div>
                <div class="b-actions">
                  <button id="bulkMute" class="btn-sm">üîá Mute all</button>
                  <button id="bulkUnmute" class="btn-sm">üîä Unmute all</button>
                  <button id="bulkCh1" class="btn-sm">üì∫ All ‚Üí CH1</button>
                </div>
              </div>
            </div>

            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Screens</div><div class="b-badges"><span class="badge" id="displayCount">0</span></div></div>
              <div class="b-expand">
                <ul id="displayList" class="list"></ul>
                <div id="displayEmpty" class="muted" style="padding:10px 0;text-align:center">Pick a dealership to list TVs üì∫</div>
              </div>
            </div>
          </div>
        </section>

        <!-- PAGE 2 ‚Äî USERS -->
        <section class="page" id="pgUsers">
          <div class="p-head">
            <div><div class="p-title">Users üë•</div><div class="p-sub">Create ‚Ä¢ reset ‚Ä¢ move ‚Ä¢ disable</div></div>
            <div>üë•</div>
          </div>

          <div class="grid">
            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Create user</div></div>
              <div class="b-expand">
                <div class="row3">
                  <div><div class="label">Email</div><input id="userEmail" class="input" placeholder="user@email.com"/></div>
                  <div><div class="label">Name</div><input id="userName" class="input" placeholder="Full name"/></div>
                  <div>
                    <div class="label">Role</div>
                    <select id="userRole" class="select"><option value="user">user</option><option value="admin">admin</option><option value="device">device</option></select>
                  </div>
                </div>
                <div class="row2">
                  <div>
                    <div class="label">Dealership</div>
                    <select id="userDealer" class="select"><option value="">Dealership‚Ä¶</option></select>
                  </div>
                  <div style="display:flex;align-items:end;gap:8px">
                    <button id="createUserBtn" class="btn-sm orange">üë§ Create</button>
                    <button id="inviteUserBtn" class="btn-sm">üìß Send reset (existing)</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Directory</div></div>
              <div class="b-expand">
                <div class="row3">
                  <div><div class="label">Search</div><input id="userSearch" class="input" placeholder="name or email‚Ä¶"/></div>
                  <div><div class="label">Dealership</div><select id="filterDealer" class="select"><option value="">All</option></select></div>
                  <div><div class="label">Role</div><select id="filterRole" class="select"><option value="">All</option><option value="admin">admin</option><option value="device">device</option><option value="user">user</option><option value="disabled">disabled</option></select></div>
                </div>
                <div class="b-actions">
                  <button id="findDupBtn" class="btn-sm">üîç Suggest duplicate device users</button>
                  <button id="disableDupBtn" class="btn-sm" disabled>‚ùå Disable suggested</button>
                </div>

                <div class="p-sub" style="margin:12px 0">Admins (<span id="countAdmins">0</span>) ‚Ä¢ Devices (<span id="countDevices">0</span>) ‚Ä¢ Users (<span id="countUsers">0</span>) ‚Ä¢ Disabled (<span id="countDisabled">0</span>)</div>

                <div class="list" id="dupList" style="display:none"></div>
                <div id="dupEmpty" class="muted" style="display:none;padding:10px 0;text-align:center">No duplicates found! üéâ</div>

                <div class="list" id="userList"></div>
                <div id="userEmpty" class="muted" style="padding:10px 0;text-align:center">No users found. Create your first user! üë§</div>
              </div>
            </div>
          </div>
        </section>

        <!-- PAGE 3 ‚Äî CALENDAR -->
        <section class="page" id="pgCalendar">
          <div class="p-head">
            <div><div class="p-title">Installations calendar üìÖ</div><div class="p-sub">Schedule by day ‚Ä¢ notes</div></div>
            <div>üìÖ</div>
          </div>

          <div class="grid">
            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Planner</div></div>
              <div class="b-expand">
                <div class="cal-head">
                  <button id="calPrev" class="btn-sm">‚óÄ</button>
                  <div><b id="calMonthLabel">Month YYYY</b></div>
                  <button id="calNext" class="btn-sm">‚ñ∂</button>
                </div>
                <div class="cal-grid" id="calDow"></div>
                <div class="cal-grid" id="calDays"></div>
              </div>
            </div>

            <div class="bubble expanded">
              <div class="b-head"><div class="b-title">Events on <span id="selDateLabel">‚Äî</span></div></div>
              <div class="b-expand">
                <div class="row2">
                  <div>
                    <div class="label">Title</div>
                    <input id="evTitle" class="input" placeholder="Installation ‚Äî showroom TV"/>
                  </div>
                  <div>
                    <div class="label">Dealership</div>
                    <select id="evDealer" class="select"><option value="">‚Äî</option></select>
                  </div>
                </div>
                <div class="row">
                  <div>
                    <div class="label">Notes</div>
                    <textarea id="evNotes" class="textarea" placeholder="Address, contact, equipment, etc."></textarea>
                  </div>
                  <div style="display:flex;align-items:end">
                    <button id="addEventBtn" class="btn-sm orange">‚ûï Add</button>
                  </div>
                </div>
                <ul id="evList" class="list"></ul>
                <div id="evEmpty" class="muted" style="padding:10px 0;text-align:center">No events scheduled for this day. Add one! ‚úÖ</div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- bottom nav -->
    <div class="nav">
      <div class="tab active" data-i="0">üè¢<small>Dealers</small></div>
      <div class="tab" data-i="1">üì∫<small>Displays</small></div>
      <div class="tab" data-i="2">üë§<small>Users</small></div>
      <div class="tab" data-i="3">üìÖ<small>Calendar</small></div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
  // ... (The JavaScript remains exactly the same as in your original code)
  // Only the CSS and HTML structure have been modified for the playful redesign
  // All functionality is preserved
</script>
</body>
</html>