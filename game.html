<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>VVAL — Truth • Truth • Dare • Lie (18+)</title>
<style>
  :root{
    --bg:#090b10; --fg:#fff; --muted:#b7bfcc;
    --panel:#111421; --tile:#15192a; --border:rgba(255,255,255,.14);
    --accent:#00d17a; --accent2:#ffd500; --danger:#ff5470;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--fg);
    background: radial-gradient(900px 600px at 15% -10%, #0b1f16 0%, transparent 60%),
                radial-gradient(900px 600px at 90% 110%, #2a1a28 0%, transparent 60%),
                linear-gradient(180deg,#0a0e14,#090b10);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }
  .app{max-width:980px; margin:0 auto; padding:18px 16px 80px}
  header{display:flex; align-items:center; gap:12px; padding:8px 6px 16px}
  .logo{
    width:44px;height:44px;border-radius:12px;
    background: conic-gradient(from 220deg,#00d17a,#ffd500,#ff5470,#00d17a);
    display:grid;place-items:center;color:#0a0a0a;font-weight:900;letter-spacing:.3px;
  }
  h1{font-size:22px; margin:0}
  .tiny{font-size:12px;color:var(--muted)}
  .panel{
    background: color-mix(in srgb, var(--panel) 92%, black 8%);
    border:1px solid var(--border); border-radius:18px; padding:18px;
    box-shadow: 0 30px 80px rgba(0,0,0,.45); backdrop-filter: blur(10px);
  }
  .grid{display:grid; gap:14px}
  @media(min-width:760px){ .grid.two{grid-template-columns:1fr 1fr} }
  .title{font-size:20px;font-weight:800; letter-spacing:.2px}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  input,button,select,label.toggle{
    border-radius:14px; border:1px solid var(--border); background:var(--tile); color:var(--fg);
  }
  input,select{padding:14px 14px; font-size:18px; min-height:52px}
  input::placeholder{color:#91a0b8}
  button{
    padding:14px 16px; font-size:18px; cursor:pointer; border-color:transparent;
    background:linear-gradient(180deg,#232735,#161a28); font-weight:800;
  }
  button.primary{
    background:linear-gradient(180deg,#00ff95,#00d17a);
    color:#0a1310; border:1px solid rgba(255,255,255,.18); text-shadow:0 1px 0 rgba(255,255,255,.35)
  }
  button.warn{background:linear-gradient(180deg,#ffe169,#ffd500); color:#201a05}
  button.danger{background:linear-gradient(180deg,#ff7f96,#ff5470)}
  button.ghost{background:transparent; border:1px dashed var(--border); color:var(--muted)}
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .chip{background:#1a2033; border:1px solid var(--border); padding:10px 12px; border-radius:999px; display:flex; gap:8px; align-items:center; font-size:16px}
  .chip button{background:transparent; border:none; color:#9aa0ad; padding:0 2px; font-size:18px; cursor:pointer}
  .sep{height:1px;background:var(--border); margin:12px 0}
  label.toggle{
    display:inline-flex; gap:10px; align-items:center; padding:10px 12px; color:#d0d5e1; background:#181e31;
  }
  .note{font-size:13px; color:#9aa0ad}
  .story{font-size:20px; line-height:1.45; background:#181e31; border:1px solid var(--border); border-radius:16px; padding:14px}
  .question{font-size:22px; font-weight:900; margin-top:10px}
  .players{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:14px}
  @media(min-width:560px){ .players{grid-template-columns:1fr 1fr 1fr} }
  .pbtn{
    min-height:64px; font-size:20px; padding:16px; border-radius:14px; border:1px solid var(--border);
    background:linear-gradient(180deg,#1e2233,#151a28); display:flex; justify-content:space-between; align-items:center;
  }
  .pbtn small{color:#a8aebd; font-weight:700; font-size:16px}
  .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
  .winner{padding:14px; border-radius:14px; background:linear-gradient(180deg, rgba(255,213,0,.22), rgba(255,213,0,.06)); border:1px solid rgba(255,213,0,.35); font-size:18px}
  .scoreboard{margin-top:14px; border-top:1px solid var(--border); padding-top:14px}
  .scores{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  @media(min-width:680px){ .scores{grid-template-columns:1fr 1fr 1fr 1fr} }
  .score{background:#181e31; border:1px solid var(--border); border-radius:12px; padding:10px 12px; display:flex; justify-content:space-between; font-size:18px}
  .hidden{display:none !important}
  .confetti{pointer-events:none; position:fixed; inset:0; overflow:hidden}
  .confetti i{position:absolute; width:10px; height:14px; border-radius:2px; opacity:.9}
  .badge{display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:900}
  .b1{background:#0b2; color:#00140a}
  .b2{background:#ffd500; color:#2a2000}
  .bigtext *{font-size: calc(1.14 * 1rem)}
  .timer{font-variant-numeric: tabular-nums; font-weight:900; font-size:18px; padding:10px 12px; border-radius:12px; background:#1d2338; border:1px solid var(--border)}
  .modeTabs{display:flex; gap:8px; flex-wrap:wrap}
  .modeTabs button{border:1px solid var(--border); background:#1a2033}
  .modeTabs button.active{outline:2px solid var(--accent); background:linear-gradient(180deg,#142a22,#101a15)}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">18+</div>
    <div>
      <h1>VVAL — Truth • Truth • Dare • Lie <span class="badge b1">18+</span></h1>
      <div class="tiny">Bluff • Vote • Timer • Light penalties • Fun, cheeky, consent-first (non-explicit)</div>
    </div>
  </header>

  <!-- SETUP -->
  <section id="setup" class="panel grid two">
    <div>
      <div class="title">Players</div>
      <div class="row" style="margin-top:8px;">
        <input id="nameInput" type="text" placeholder="Type a name and press Add" onkeydown="if(event.key==='Enter') addPlayer()">
        <button class="primary" onclick="addPlayer()">Add</button>
        <button class="ghost" onclick="demoFill()">Demo</button>
      </div>
      <div id="chips" class="chips"></div>
      <div class="sep"></div>
      <div class="row">
        <label class="toggle"><input id="adultsOnly" type="checkbox" style="accent-color:var(--accent)"> I confirm all players are 18+</label>
        <label class="toggle"><input id="bigText" type="checkbox" style="accent-color:var(--accent2)"> Big text</label>
      </div>
      <div class="note">Quick rules: no pressure, no shaming, consent always. You can swap a dare for a light penalty.</div>
    </div>

    <div>
      <div class="title">Mode & Duration</div>
      <div class="modeTabs" style="margin-top:8px;">
        <button id="tab-ttdl" class="active" onclick="setMode('ttdl')">TTDL</button>
        <button id="tab-roulette" onclick="setMode('roulette')">Roulette</button>
        <button id="tab-duel" onclick="setMode('duel')">Duel</button>
      </div>
      <div class="sep"></div>
      <div class="row">
        <select id="roundSecs">
          <option value="30">Timer 30s</option>
          <option value="45">Timer 45s</option>
          <option value="60" selected>Timer 60s</option>
          <option value="0">No timer</option>
        </select>
        <select id="penaltySel">
          <option value="sip">Penalty: 1 sip</option>
          <option value="dance">Penalty: 5s dance move</option>
          <option value="accent">Penalty: speak with an accent next round</option>
        </select>
        <button class="warn" onclick="startGame()">Start</button>
      </div>
      <div class="note">Modes: <b>TTDL</b> (bluff + voting), <b>Roulette</b> (spin and do), <b>Duel</b> (1v1 mini-scene). 18+ is cheeky, never graphic.</div>
    </div>
  </section>

  <!-- ROUND -->
  <section id="round" class="panel hidden">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <div class="title">Round <span id="roundNum">1</span> • <span id="modeLabel">TTDL</span></div>
      <div class="row">
        <div class="timer" id="timerBox">—</div>
        <button onclick="nextRound()">Next</button>
        <button class="danger" onclick="endGame()">End</button>
      </div>
    </div>

    <div class="story" id="storyBox"></div>
    <div class="question" id="questionText"></div>

    <div class="players" id="playerButtons"></div>

    <div class="toolbar">
      <button onclick="undoVote()">Undo vote</button>
      <button onclick="clearVotes()">Clear votes</button>
      <button class="primary" onclick="reveal()">Reveal</button>
    </div>

    <div id="winnerBlock" class="winner hidden" aria-live="polite"></div>

    <div class="scoreboard">
      <div class="title" style="font-size:18px">Scoreboard</div>
      <div id="scores" class="scores"></div>
    </div>
  </section>
</div>

<!-- confetti -->
<div class="confetti" id="confetti"></div>

<script>
/* ===== State ===== */
const state = {
  players:[], scores:new Map(), round:1,
  votes:[], voteCount:new Map(),
  mode:'ttdl', // ttdl | roulette | duel
  secs:60, penalty:'sip',
  rngSeed: Date.now()%2147483647,
  ticking:null
};
function rand(){ state.rngSeed = (state.rngSeed*48271)%2147483647; return (state.rngSeed-1)/2147483646; }
function choice(a){ return a[Math.floor(rand()*a.length)] }

/* ===== Elements ===== */
const setup = document.getElementById('setup');
const roundEl = document.getElementById('round');
const chips = document.getElementById('chips');
const nameInput = document.getElementById('nameInput');
const adultsOnly = document.getElementById('adultsOnly');
const bigText = document.getElementById('bigText');
const roundSecs = document.getElementById('roundSecs');
const penaltySel = document.getElementById('penaltySel');
const modeLabel = document.getElementById('modeLabel');
const storyBox = document.getElementById('storyBox');
const questionText = document.getElementById('questionText');
const playerButtons = document.getElementById('playerButtons');
const roundNum = document.getElementById('roundNum');
const winnerBlock = document.getElementById('winnerBlock');
const scoresEl = document.getElementById('scores');
const timerBox = document.getElementById('timerBox');

/* ===== Setup UI ===== */
function renderChips(){
  chips.innerHTML='';
  state.players.forEach((n,i)=>{
    const d=document.createElement('div'); d.className='chip';
    d.innerHTML = `<b>${escapeHtml(n)}</b><button title="Remove" onclick="removePlayer(${i})">✕</button>`;
    chips.appendChild(d);
  });
}
function addPlayer(){
  const v=nameInput.value.trim(); if(!v) return;
  if(state.players.includes(v)) { nameInput.value=''; return; }
  state.players.push(v); state.scores.set(v, state.scores.get(v)||0);
  renderChips(); nameInput.value='';
}
function removePlayer(i){
  const n=state.players[i]; state.players.splice(i,1); state.scores.delete(n); renderChips();
}
function demoFill(){ ['Alex','Maya','Jo','Pri','Sam','Nico'].forEach(n=>{ if(!state.players.includes(n)){ state.players.push(n); state.scores.set(n,0); } }); renderChips(); }

function setMode(m){
  state.mode=m;
  document.getElementById('tab-ttdl').classList.toggle('active', m==='ttdl');
  document.getElementById('tab-roulette').classList.toggle('active', m==='roulette');
  document.getElementById('tab-duel').classList.toggle('active', m==='duel');
}

/* ===== Content (party vibe; 18+ light, non-explicit) ===== */
const places = [
  "a rooftop bar", "a midnight beach", "a neon-lit club", "a cozy balcony party",
  "a crowded karaoke room", "a backyard BBQ", "a speakeasy with velvet chairs",
  "a festival afterparty", "a lakeside bonfire", "a swanky hotel lobby"
];
const props = [
  "a neon sunglasses pair","a glitter fan","a tiny towel (why?)","a heart balloon",
  "a tray of mystery shots","a feather boa","a plastic trophy cup","a lipstick-stained napkin",
  "a stray confetti cannon","a disposable camera"
];
const beats = [
  "The DJ replays the chorus for the third time and everyone screams.",
  "Breeze warms up, chat cools down, energy rises.",
  "The playlist jumps to a classic sing-along without warning.",
  "The bathroom line becomes reality TV.",
  "A message arrives: “Where are you guys?” and nobody knows.",
  "Someone declares: “No judgment!” and it becomes law."
];

/* TRUTHS (PG) */
const truthsPG = [
  "share an unlikely crush from your life",
  "tell your most awkward moment on a date (keep it classy)",
  "say the best or worst pick-up line you’ve ever received",
  "admit a quirky habit nobody here knows",
  "say who here you’d invite for a cute, harmless hangout",
  "tell a recent workplace oops",
  "show your most-used emoji and explain why",
  "reveal your family’s secret nickname for you",
  "admit who you occasionally check on social media",
  "describe a bizarre dream you actually had"
];

/* TRUTHS (18+ cheeky, non-explicit) */
const truths18 = [
  "reveal your most charming ‘red flag’",
  "tell a moment you thought was ‘sweet but a little spicy’ (no graphic detail)",
  "admit who here would have the best shot flirting with you",
  "share the most creative line you’ve used",
  "say which song flips your flirty switch",
  "confess the last time a flirt left you speechless",
  "tell a date plot twist that became legendary",
  "say your ‘superpower’ in romantic vibes",
  "name a hard boundary you always respect (consent = king/queen)",
  "share a cheeky compliment you’d give with elegance"
];

/* DARES (PG and 18+ lite; consent-first) */
const daresPG = [
  "toast dramatically like a soap-opera star",
  "do your secret dance move for 5 seconds",
  "invent a poetic pick-up line and say it to the ceiling",
  "strike a Carnival-style photo pose for 3 seconds",
  "sell grilled cheese on a beach… convincingly (voice only)",
  "narrate the table like a sports commentator for 10 seconds",
  "make a heart with your hands to the person on your left",
  "pitch your star sign like a 5-second ad",
  "give your best beauty-pageant wave to the ‘camera’"
];
const dares18 = [
  "teach a hip sway (PG-13) without touching anyone",
  "give a 10/10 flirty look (from a respectful distance)",
  "do a waist groove for 7 seconds (PG-13)",
  "deliver a warm, tasteful compliment (with their okay)",
  "create a ‘consent contract’ in 10 seconds and read it out",
  "run a ‘summer heat’ runway walk with your fiercest face",
  "announce a cinematic kiss like a movie trailer (no kiss)",
  "give a toast ‘to situationships’ with rhyme and class",
  "perform a suave ‘high-five and strut away’ bit",
  "throw three theatrical winks and a killer wave"
];

/* LIES (bluff prompts — group votes if it’s true or a lie) */
const liesDeck = [
  "claim you once turned down a VIP invite from a celebrity",
  "say you learned a dance move after watching it only once",
  "insist you became the DJ by accident at a party",
  "tell that you hitchhiked into an unforgettable night",
  "say you improvised as a tour guide on a seaside walk",
  "claim you won a ‘best smile’ contest",
  "say people once confused you for an influencer",
  "tell how you saved a BBQ from total disaster",
  "say you trended online for 24 hours",
  "claim you talked your way past security (politely!)"
];

/* ===== Helpers ===== */
function aAn(word){
  return (/^[aeiou]/i.test(word) ? 'an ' : 'a ') + word;
}
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }

/* ===== Game Flow ===== */
function startGame(){
  if(state.players.length<2){ alert('Add at least 2 players.'); return; }
  if(!adultsOnly.checked){ alert('Please confirm all players are 18+ to use this deck.'); return; }
  document.body.classList.toggle('bigtext', bigText.checked);
  state.secs = parseInt(roundSecs.value,10) || 0;
  state.penalty = penaltySel.value;
  setup.classList.add('hidden'); roundEl.classList.remove('hidden');
  state.round = 1; nextRound(true);
}
function buildPlayerButtons(){
  playerButtons.innerHTML='';
  state.players.forEach(p=>{
    const b=document.createElement('button'); b.className='pbtn'; b.onclick=()=>vote(p,b);
    b.innerHTML=`<span>${escapeHtml(p)}</span><small>0</small>`; playerButtons.appendChild(b);
  });
}
function resetVotes(){
  state.votes=[]; state.voteCount=new Map(state.players.map(p=>[p,0]));
  [...playerButtons.children].forEach(b=>b.querySelector('small').textContent='0');
  winnerBlock.classList.add('hidden'); winnerBlock.innerHTML='';
}
function vote(name, btn){
  const c=(state.voteCount.get(name)||0)+1; state.voteCount.set(name,c);
  state.votes.push(name); btn.querySelector('small').textContent=String(c);
}
function undoVote(){
  const last=state.votes.pop(); if(!last) return;
  const c=(state.voteCount.get(last)||0)-1; state.voteCount.set(last,Math.max(0,c));
  [...playerButtons.children].forEach(b=>{
    if(b.querySelector('span').textContent===last) b.querySelector('small').textContent=String(Math.max(0,c));
  });
}
function clearVotes(){ resetVotes(); }

/* ===== Rounds ===== */
function nextRound(first=false){
  if(!first) state.round++;
  roundNum.textContent = state.round;
  modeLabel.textContent = state.mode==='ttdl'?'TTDL':state.mode==='roulette'?'Roulette':'Duel';
  const {story, prompt} = buildPrompt();
  storyBox.innerHTML = story; questionText.textContent = prompt;
  buildPlayerButtons(); resetVotes(); startTimer();
  window.scrollTo({top:0,behavior:'smooth'});
}
function buildPrompt(){
  const place = choice(places), prop = choice(props), beat = choice(beats);
  const story = `<b>Scene:</b> You’re at ${place}. ${beat} Someone shows up with ${aAn(prop)}.`;

  if(state.mode==='roulette'){
    const pool = choice([truthsPG, truths18, daresPG, dares18, liesDeck]);
    const type = pool===liesDeck ? 'Lie' : (pool===truthsPG||pool===truths18 ? 'Truth' : 'Dare');
    const act = choice(pool);
    return {story, prompt:`${type}: ${act}.`};
  }

  if(state.mode==='duel'){
    const a = choice(state.players); let b=a; while(b===a){ b=choice(state.players); }
    const theme = choice([
      "best smooth talk in 10 seconds (no cheesy words)",
      "hip-isolation dance (no touching), 7 seconds",
      "funniest confident compliment (PG-13)",
      "make your star sign sound irresistible in 7 seconds",
      "runway walk like it’s Carnival — fierce face only"
    ]);
    return {story, prompt:`Duel: ${a} vs ${b} — ${theme}. Group taps to vote the winner.`};
  }

  // TTDL (Truth • Truth • Dare • Lie)
  const step = choice(['Truth','Truth','Dare','Lie']);
  let act;
  if(step==='Truth'){ act = choice(truthsPG.concat(truths18)); }
  if(step==='Dare'){ act = choice(daresPG.concat(dares18)); }
  if(step==='Lie'){ act = choice(liesDeck); }
  const target = choice(state.players);
  const prompt = `${step} for ${target}: ${act}. (Bluff allowed on Lie — group votes!)`;
  return {story, prompt};
}

/* ===== Timer ===== */
function startTimer(){
  if(state.ticking){ clearInterval(state.ticking); state.ticking=null; }
  if(!state.secs){ timerBox.textContent='—'; return; }
  let t=state.secs; timerBox.textContent = formatS(t);
  state.ticking=setInterval(()=>{
    t--; timerBox.textContent = formatS(t);
    if(t<=0){ clearInterval(state.ticking); state.ticking=null; timerBox.textContent='⏰'; }
  },1000);
}
function formatS(s){ if(s<0) s=0; return `00:${String(s).padStart(2,'0')}`; }

/* ===== Reveal & Scoring ===== */
function reveal(){
  let max=-1,tops=[];
  state.voteCount.forEach((v,k)=>{ if(v>max){max=v;tops=[k]} else if(v===max){tops.push(k)} });
  if(max<=0){ alert('No votes yet. Tap a name to vote.'); return; }
  const winner = choice(tops);
  state.scores.set(winner,(state.scores.get(winner)||0)+1);
  renderScores();
  const end = buildEnding(winner);
  winnerBlock.innerHTML = `🏆 <b>${escapeHtml(winner)}</b> takes it with ${max} vote${max>1?'s':''}.<br>${end} ${penaltyHint()}`;
  winnerBlock.classList.remove('hidden');
  confetti();
}
function penaltyHint(){
  if(state.mode!=='ttdl') return '';
  return `<br><span class="tiny">Missed a dare? Do your penalty: ${penaltyLabel(state.penalty)}.</span>`;
}
function penaltyLabel(k){
  return k==='sip'?'1 sip':k==='dance'?'5s dance move':'speak with an accent next round';
}
function endGame(){
  const top = Math.max(...[...state.scores.values(),0]);
  const champs = [...state.scores.entries()].filter(([_,v])=>v===top).map(([k])=>k);
  alert(top>0?`Winner${champs.length>1?'s':''}: ${champs.join(', ')} with ${top} point${top>1?'s':''}!`:'No points!');
}

/* ===== Endings ===== */
function buildEnding(winner){
  const tags = [
    `${winner} grins: “Character development, baby.”`,
    `${winner} promises a tutorial at the next BBQ.`,
    `${winner} triggers a slow-clap from exactly one person. Iconic.`,
    `${winner} declares: “No screenshots, only memories.”`,
    `${winner} poses like a retro DVD cover and somehow nails it.`,
    `${winner} says it was a social experiment. We… believe it.`
  ];
  return choice(tags);
}

/* ===== Scoreboard ===== */
function renderScores(){
  const arr=[...state.scores.entries()].sort((a,b)=>b[1]-a[1]||a[0].localeCompare(b[0]));
  scoresEl.innerHTML=''; arr.forEach(([n,s])=>{
    const d=document.createElement('div'); d.className='score';
    d.innerHTML=`<span>${escapeHtml(n)}</span><b>${s}</b>`; scoresEl.appendChild(d);
  });
}

/* ===== Confetti ===== */
function confetti(){
  const host=document.getElementById('confetti');
  for(let i=0;i<100;i++){
    const p=document.createElement('i');
    p.style.left=(Math.random()*100)+'%'; p.style.top='-8%';
    p.style.background=`hsl(${Math.random()*360},90%,60%)`;
    const dur=3+Math.random()*2, rot=(Math.random()*720-360)+'deg';
    p.animate([
      {transform:`translate(-50%,0) rotate(0deg)`, opacity:1},
      {transform:`translate(${(Math.random()*120-60)}px, 110vh) rotate(${rot})`, opacity:1}
    ],{duration: dur*1000, easing:'cubic-bezier(.2,.6,.2,1)'}).onfinish=()=>p.remove();
    host.appendChild(p);
  }
}

/* ===== Utilities ===== */
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }

/* Init */
renderChips();
renderScores();
</script>
</body>
</html>