<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BFA IPTV — Liquid Glass Monitor Wall</title>

<!-- hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>

<style>
  :root{
    --brand:#ff6a00;
    --brand2:#ff9330;
    --brand-deep:#e85f00;

    --fg:#0f172a;
    --muted:#94a3b8;

    --shell-radius:32px;
    --card-radius:24px;

    --shadow-strong:0 32px 90px rgba(15,23,42,.7);
    --shadow-soft:0 20px 60px rgba(15,23,42,.35);
    --shadow-inner:inset 0 1px 0 rgba(255,255,255,.55),
                    inset 0 -1px 0 rgba(15,23,42,.12);
  }

  *{box-sizing:border-box;margin:0;padding:0;}
  html,body{
    width:100%;
    height:100%;
    overflow:hidden;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    color:var(--fg);
  }

  body{
    background:
      radial-gradient(circle at -10% 0%, #fff1d9 0%, #ffcb83 18%, transparent 35%),
      radial-gradient(circle at 110% 0%, #ffc0ca 0%, #ff8994 20%, transparent 45%),
      radial-gradient(circle at 10% 110%, #ffefcf 0%, #ffd098 18%, transparent 40%),
      radial-gradient(circle at 85% 120%, #ffb964 0%, #ff6a00 35%, #1a1023 70%),
      linear-gradient(145deg, #050816 0%, #050312 40%, #14051a 100%);
  }

  .frame{
    position:relative;
    width:100%;
    height:100%;
    padding:22px;
  }

  .shell{
    position:relative;
    width:100%;
    height:100%;
    border-radius:var(--shell-radius);
    background:linear-gradient(145deg,rgba(255,255,255,.78),rgba(245,248,255,.70));
    box-shadow:var(--shadow-strong);
    padding:18px 22px 20px;
    display:flex;
    flex-direction:column;
    backdrop-filter:blur(26px) saturate(170%);
    -webkit-backdrop-filter:blur(26px) saturate(170%);
    border:1px solid rgba(255,255,255,.78);
  }

  .shell-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:18px;
    margin-bottom:14px;
  }

  .brand-left{
    display:flex;
    align-items:center;
    gap:16px;
    min-width:0;
  }

  .logo-wrap{
    width:64px;
    height:64px;
    border-radius:26px;
    background:
      radial-gradient(circle at 20% 20%, #fff4dd 0%, #ffc477 28%, #ff6a00 65%, #b44100 100%);
    box-shadow:
      0 20px 40px rgba(15,23,42,.55),
      0 0 0 1px rgba(255,255,255,.7);
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
  }

  .logo-orbit{
    position:absolute;
    inset:-40%;
    background:conic-gradient(from 200deg,
      rgba(255,255,255,.7),
      rgba(255,255,255,.05),
      rgba(255,255,255,.7));
    opacity:.25;
    mix-blend-mode:soft-light;
    filter:blur(22px);
    pointer-events:none;
  }

  .logo{
    position:relative;
    width:40px;
    height:40px;
    border-radius:16px;
    box-shadow:0 12px 30px rgba(0,0,0,.55);
    background:#ff6a00;
  }

  .brand-text{min-width:0;}
  .brand-title{
    font-size:22px;
    font-weight:800;
    color:#020617;
    letter-spacing:.02em;
  }
  .brand-sub{
    font-size:12px;
    color:var(--muted);
    margin-top:4px;
  }

  .pill{
    padding:8px 15px;
    border-radius:999px;
    background:linear-gradient(135deg,rgba(15,23,42,.98),rgba(15,23,42,.90));
    border:1px solid rgba(255,255,255,.18);
    color:#e5e7eb;
    font-size:11px;
    display:inline-flex;
    align-items:center;
    gap:7px;
    box-shadow:0 22px 46px rgba(15,23,42,.9);
    white-space:nowrap;
    backdrop-filter:blur(20px) saturate(190%);
    -webkit-backdrop-filter:blur(20px) saturate(190%);
  }

  .pill-dot{
    width:9px;
    height:9px;
    border-radius:999px;
    background:#22c55e;
    box-shadow:0 0 0 0 rgba(34,197,94,.75);
    animation:pulse 1.6s infinite;
  }
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(34,197,94,.7);}
    70%{box-shadow:0 0 0 14px rgba(34,197,94,0);}
    100%{box-shadow:0 0 0 0 rgba(34,197,94,0);}
  }

  .layout{
    flex:1;
    min-height:0;
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  .hero-wrap{
    flex:1;
    min-height:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .hero-shell{
    width:100%;
    max-width:1420px;
    border-radius:var(--card-radius);
    background:radial-gradient(circle at top,#020617,#020617);
    box-shadow:var(--shadow-soft);
    border:1px solid rgba(15,23,42,.9);
    overflow:hidden;
    position:relative;
  }

  .hero-glow{
    position:absolute;
    inset:-40%;
    background:
      radial-gradient(circle at 10% 0%,rgba(255,255,255,.14),transparent 55%),
      radial-gradient(circle at 110% 0%,rgba(255,255,255,.14),transparent 60%),
      radial-gradient(circle at 50% 120%,rgba(255,106,0,.45),transparent 70%);
    opacity:.9;
    mix-blend-mode:soft-light;
    pointer-events:none;
    filter:blur(28px);
  }

  .hero-16x9{
    position:relative;
    width:100%;
    height:0;
    padding-top:56.25%;
  }
  .hero-16x9 video{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    background:#000;
    display:block;
  }

  .hero-overlay{
    position:absolute;
    left:0;right:0;bottom:0;
    padding:12px 16px 14px;
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    pointer-events:none;
    background:linear-gradient(180deg,
      rgba(15,23,42,0) 0%,
      rgba(15,23,42,.30) 30%,
      rgba(15,23,42,.90) 80%,
      rgba(3,7,18,.98) 100%);
    backdrop-filter:blur(18px) saturate(180%);
    -webkit-backdrop-filter:blur(18px) saturate(180%);
  }

  .hero-left{max-width:70%;}
  .hero-kicker{
    font-size:10px;
    letter-spacing:.18em;
    text-transform:uppercase;
    color:rgba(226,232,240,.85);
    margin-bottom:4px;
  }
  .hero-name{
    font-weight:800;
    font-size:16px;
    color:#f9fafb;
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow:hidden;
  }
  .hero-meta{
    font-size:11px;
    color:#cbd5f5;
    margin-top:4px;
  }

  .hero-tag{
    padding:6px 12px;
    border-radius:999px;
    font-size:11px;
    background:radial-gradient(circle at 0% 0%,rgba(255,255,255,.35),rgba(255,255,255,.02));
    color:#020617;
    border:1px solid rgba(255,255,255,.7);
    box-shadow:
      0 16px 38px rgba(15,23,42,.85),
      0 0 0 1px rgba(148,163,184,.55);
    display:flex;
    align-items:center;
    gap:7px;
  }
  .hero-tag-dot{
    width:8px;height:8px;border-radius:999px;background:#22c55e;
    box-shadow:0 0 8px rgba(34,197,94,.9);
  }

  .dock-shell{
    border-radius:var(--card-radius);
    background:radial-gradient(circle at 0% 0%,rgba(255,255,255,.95),rgba(248,244,239,.96));
    box-shadow:var(--shadow-soft);
    padding:9px 10px 12px;
    border:1px solid rgba(255,255,255,.9);
    backdrop-filter:blur(24px) saturate(180%);
    -webkit-backdrop-filter:blur(24px) saturate(180%);
  }

  .dock-title{
    font-size:12px;
    font-weight:600;
    color:var(--muted);
    margin:0 2px 8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .dock-title span:last-child{font-weight:500;}

  .dock{
    display:grid;
    grid-auto-rows:1fr;
    gap:9px;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  }

  .dock-item{
    position:relative;
    border-radius:18px;
    background:radial-gradient(circle at top,#020617,#020617);
    box-shadow:0 12px 28px rgba(15,23,42,.35);
    border:1px solid rgba(15,23,42,.85);
    overflow:hidden;
    cursor:pointer;
    -webkit-tap-highlight-color:transparent;
    transition:
      transform .25s cubic-bezier(.19,1,.22,1),
      box-shadow .25s cubic-bezier(.19,1,.22,1),
      border-color .18s ease,
      background .18s ease,
      outline-offset .18s ease;
  }

  .dock-item-inner{
    position:relative;
    width:100%;
    height:0;
    padding-top:56.25%;
  }

  .dock-item video{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    background:#000;
    display:block;
  }

  .dock-overlay{
    position:absolute;
    left:0;right:0;bottom:0;
    padding:6px 9px;
    background:linear-gradient(180deg,
      rgba(0,0,0,0) 0%,
      rgba(0,0,0,.85) 55%,
      rgba(0,0,0,.98) 100%);
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:10px;
    color:#e5e7eb;
    backdrop-filter:blur(12px) saturate(180%);
    -webkit-backdrop-filter:blur(12px) saturate(180%);
  }
  .dock-name{
    font-weight:600;
    max-width:70%;
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow:hidden;
  }
  .dock-status{
    font-size:10px;
    color:#cbd5f5;
    opacity:.95;
  }
  .dock-status.err{color:#fecaca;}
  .dock-status.idle{color:#9ca3af;}

  .dock-item-active{
    transform:translateY(-4px) scale(1.04);
    border-color:rgba(255,149,0,.95);
    background:
      radial-gradient(circle at 0% 0%,rgba(255,255,255,.15),transparent 40%),
      radial-gradient(circle at 100% 100%,rgba(255,106,0,.35),transparent 60%),
      radial-gradient(circle at top,#020617,#020617);
    box-shadow:
      0 26px 60px rgba(15,23,42,.7),
      0 0 0 1px rgba(255,149,0,.7),
      0 0 30px rgba(255,149,0,.8);
  }
  .dock-item-active .dock-overlay{
    background:linear-gradient(180deg,
      rgba(24,16,6,0) 0%,
      rgba(24,16,6,.9) 52%,
      rgba(21,10,0,.98) 100%);
  }
  .dock-item-active .dock-status{
    color:#fed7aa;
  }

  .hint{
    margin-top:4px;
    font-size:11px;
    color:var(--muted);
    text-align:right;
  }

  .err-banner{
    position:absolute;
    left:50%;bottom:24px;
    transform:translateX(-50%);
    background:rgba(239,68,68,.96);
    color:#fff;
    padding:7px 14px;
    border-radius:999px;
    font-size:11px;
    box-shadow:0 18px 44px rgba(0,0,0,.7);
    display:none;
    z-index:40;
  }

  @media (max-width:1100px){
    .shell{padding:14px 14px 18px;}
    .shell-header{flex-direction:column;align-items:flex-start;gap:10px;}
    .pill{align-self:flex-end;}
  }
</style>
</head>

<body>
<div class="frame">
  <div class="shell">
    <header class="shell-header">
      <div class="brand-left">
        <div class="logo-wrap">
          <div class="logo-orbit"></div>
          <img class="logo" src="/IPTV-/icons/icon-192.png" alt="BFA logo"
               onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22 viewBox=%220 0 40 40%22%3E%3Crect width=%2240%22 height=%2240%22 rx=%2216%22 fill=%22%23ff6a00%22/%3E%3Ctext x=%2250%25%22 y=%2255%25%22 text-anchor=%22middle%22 font-size=%2214%22 font-family=%22system-ui%22 font-weight=%22800%22 fill=%22%23fff%22%3EBFA%3C/text%3E%3C/svg%3E';">
        </div>
        <div class="brand-text">
          <div class="brand-title">BFA IPTV — Liquid Glass Monitor Wall</div>
          <div class="brand-sub">Hero channel on top • Dock thumbnails all live • 16:9 everywhere • 1920×1080 ready</div>
        </div>
      </div>
      <div class="pill">
        <span class="pill-dot"></span>
        <span id="statusLabel">Starting…</span>
      </div>
    </header>

    <section class="layout">
      <div class="hero-wrap">
        <div class="hero-shell">
          <div class="hero-glow"></div>
          <div class="hero-16x9">
            <video id="heroVideo" autoplay muted playsinline></video>
            <div class="hero-overlay">
              <div class="hero-left">
                <div class="hero-kicker">Now showing</div>
                <div class="hero-name" id="heroName">—</div>
                <div class="hero-meta" id="heroMeta">Loading…</div>
              </div>
              <div class="hero-tag">
                <span class="hero-tag-dot"></span>
                <span id="heroTagText">LIVE • 1/1</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="dock-shell">
        <div class="dock-title">
          <span>Channel dock</span>
          <span id="dockSummary"></span>
        </div>
        <div id="dock" class="dock"></div>
      </div>

      <div class="hint">All dock tiles are live (heavy). If a stream freezes, it auto-restarts.</div>
    </section>
  </div>

  <div id="errBanner" class="err-banner"></div>
</div>

<script>
  // ===============================
  // CONFIG (edit this only)
  // ===============================
  const CONFIG = {
    ROTATE_SECONDS: 25,

    // Stability tuning for "many streams at once"
    HERO_BUFFER_SEC: 14,
    DOCK_BUFFER_SEC: 6,
    WATCHDOG_INTERVAL_MS: 5000, // checks every 5s
    WATCHDOG_STRIKES: 3,        // ~15s stuck -> restart
    RESTART_BACKOFF_MS: 1200,

    channels: [
      { name: "Sport 1", url: "https://amg02298-nuvyoo-amg02298c4-tablo-us-8942.playouts.now.amagi.tv/playlist.m3u8" },
      { name: "Sport 2", url: "https://amg01334-amg01334c2-tablo-us-7356.playouts.now.amagi.tv/playlist.m3u8" },
      { name: "Sport 3", url: "https://fl31.moveonjoy.com/CBS_SPORTS_NETWORK/index.m3u8" },
      { name: "Sport 4", url: "https://37b4c228.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWZyX0ZJRkFQbHVzRnJlbmNoX0hMUw/playlist.m3u8" },
      { name: "Sport 5", url: "https://amg01416-amg01416c4-tablo-us-4553.playouts.now.amagi.tv/playlist.m3u8" },
      { name: "Sport 6", url: "https://dazn-combat-rakuten.amagi.tv/hls/amagi_hls_data_rakutenAA-dazn-combat-rakuten/CDN/master.m3u8" },
      { name: "Sport 7", url: "https://fl1.moveonjoy.com/SNY/index.m3u8" }
    ]
  };

  // ===============================
  // RUNTIME
  // ===============================
  const isUrl = u => /^https?:\/\/\S+$/i.test((u||'').trim());
  const statusLabel = document.getElementById('statusLabel');
  const errBanner   = document.getElementById('errBanner');
  const dock        = document.getElementById('dock');
  const dockSummary = document.getElementById('dockSummary');

  const heroVideo   = document.getElementById('heroVideo');
  const heroNameEl  = document.getElementById('heroName');
  const heroMetaEl  = document.getElementById('heroMeta');
  const heroTagText = document.getElementById('heroTagText');

  let CHANNELS = [];
  let heroIndex = 0;

  // track per-video stream state (for watchdog + restarts)
  const streams = new Map(); // videoEl -> { kind, url, statusEl, hls, lastTime, strikes, restarting }

  let heroRotateTimer = null;
  let watchdogTimer = null;

  function showBanner(msg){
    errBanner.textContent = msg;
    errBanner.style.display = 'block';
  }
  function hideBanner(){
    errBanner.style.display = 'none';
  }

  function setStatus(statusEl, text, cls){
    if (!statusEl) return;
    statusEl.textContent = text;
    statusEl.className = 'dock-status' + (cls ? (' ' + cls) : '');
  }

  function unload(video){
    const st = streams.get(video);
    if (st?.hls){
      try { st.hls.destroy(); } catch(e){}
    }
    streams.delete(video);

    try { video.pause(); } catch(e){}
    video.removeAttribute('src');
    try { video.load(); } catch(e){}
  }

  function makeHls(video, url, kind){
    const maxBuf = (kind === 'hero' ? CONFIG.HERO_BUFFER_SEC : CONFIG.DOCK_BUFFER_SEC);

    return new Hls({
      // Avoid spawning a worker per dock tile (too many workers can destabilize some setups)
      enableWorker: (kind === 'hero'),
      lowLatencyMode: (kind === 'hero'),

      // Smaller buffers reduce "runs fine then dies" behavior
      backBufferLength: 0,
      maxBufferLength: maxBuf,
      maxMaxBufferLength: maxBuf * 2,

      // Thumbnails: prefer lower renditions if available
      capLevelToPlayerSize: true,
      useDevicePixelRatio: false,

      // Fail faster instead of retrying forever
      manifestLoadingMaxRetry: 3,
      fragLoadingMaxRetry: 3,
      fragLoadingRetryDelay: 1000,
      fragLoadingMaxRetryTimeout: 8000
    });
  }

  function restartStream(video, reason){
    const st = streams.get(video);
    if (!st || st.restarting) return;
    st.restarting = true;

    if (st.kind === 'hero'){
      heroMetaEl.textContent = reason || 'Restarting…';
    } else {
      setStatus(st.statusEl, reason || 'Restarting…', 'idle');
    }

    setTimeout(() => {
      st.restarting = false;
      attachStream(video, st.url, st.statusEl, st.kind);
    }, CONFIG.RESTART_BACKOFF_MS);
  }

  function attachStream(video, url, statusEl, kind){
    if (!isUrl(url)){
      if (kind === 'hero'){
        heroMetaEl.textContent = 'No URL';
      } else {
        setStatus(statusEl, 'No URL', 'err');
      }
      return;
    }

    unload(video);

    // create state
    streams.set(video, {
      kind,
      url,
      statusEl,
      hls: null,
      lastTime: -1,
      strikes: 0,
      restarting: false
    });

    if (kind === 'hero'){
      heroMetaEl.textContent = 'Loading…';
    } else {
      setStatus(statusEl, 'Loading…', '');
    }

    // HLS.js path (Chrome, most TVs)
    if (window.Hls && Hls.isSupported()){
      const hls = makeHls(video, url, kind);
      const st = streams.get(video);
      st.hls = hls;

      hls.loadSource(url);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        video.play().then(() => {
          if (kind === 'hero') heroMetaEl.textContent = 'LIVE • HLS.js';
          else setStatus(statusEl, 'LIVE', '');
        }).catch(() => {
          if (kind === 'hero') heroMetaEl.textContent = 'Tap to play';
          else setStatus(statusEl, 'Tap', 'idle');
        });
      });

      hls.on(Hls.Events.ERROR, (_, data) => {
        if (!data) return;

        // Non-fatal errors can happen—don’t spam restarts.
        if (!data.fatal) return;

        const st2 = streams.get(video);
        if (!st2) return;

        if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
          // try restart load; if it still fails watchdog will restart
          if (kind === 'hero') heroMetaEl.textContent = 'Reconnecting…';
          else setStatus(statusEl, 'Reconnecting…', 'idle');
          try { hls.startLoad(); } catch(e) { restartStream(video, 'Net error…'); }
          return;
        }

        if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
          if (kind === 'hero') heroMetaEl.textContent = 'Recovering…';
          else setStatus(statusEl, 'Recovering…', 'idle');
          try { hls.recoverMediaError(); } catch(e) { restartStream(video, 'Media error…'); }
          return;
        }

        restartStream(video, 'Error…');
      });

      video.onerror = () => restartStream(video, 'Video error…');

      return;
    }

    // Native HLS (Safari)
    if (video.canPlayType('application/vnd.apple.mpegurl')){
      video.src = url;
      video.play().then(() => {
        if (kind === 'hero') heroMetaEl.textContent = 'LIVE • native';
        else setStatus(statusEl, 'LIVE', '');
      }).catch(() => {
        if (kind === 'hero') heroMetaEl.textContent = 'Tap to play';
        else setStatus(statusEl, 'Tap', 'idle');
      });
      video.onerror = () => restartStream(video, 'Video error…');
      return;
    }

    // fallback
    video.src = url;
    if (kind === 'hero') heroMetaEl.textContent = 'HLS not supported';
    else setStatus(statusEl, 'HLS?', 'idle');
  }

  function loadHero(idx){
    if (!CHANNELS.length) return;
    heroIndex = (idx + CHANNELS.length) % CHANNELS.length;
    const ch = CHANNELS[heroIndex];

    heroNameEl.textContent = ch.name || `Channel ${heroIndex+1}`;
    heroTagText.textContent = `LIVE • ${heroIndex+1}/${CHANNELS.length}`;
    hideBanner();

    // highlight active dock tile
    dock.querySelectorAll('.dock-item').forEach((el, i)=>{
      el.classList.toggle('dock-item-active', i === heroIndex);
    });

    attachStream(heroVideo, ch.url, null, 'hero');

    // safer rotation (no overlap)
    if (heroRotateTimer) clearTimeout(heroRotateTimer);
    if (CHANNELS.length > 1){
      heroRotateTimer = setTimeout(() => {
        loadHero(heroIndex + 1);
      }, (CONFIG.ROTATE_SECONDS || 25) * 1000);
    }
  }

  function buildDock(){
    dock.innerHTML = '';

    CHANNELS.forEach((ch, idx) => {
      const item = document.createElement('button');
      item.type = 'button';
      item.className = 'dock-item';

      const inner = document.createElement('div');
      inner.className = 'dock-item-inner';

      const v = document.createElement('video');
      v.autoplay = true;
      v.muted = true;
      v.playsInline = true;
      v.preload = 'metadata';
      v.disablePictureInPicture = true;

      const overlay = document.createElement('div');
      overlay.className = 'dock-overlay';

      const nameEl = document.createElement('div');
      nameEl.className = 'dock-name';
      nameEl.textContent = ch.name || `Channel ${idx+1}`;

      const statusEl = document.createElement('div');
      statusEl.className = 'dock-status';
      statusEl.textContent = 'Loading…';

      overlay.appendChild(nameEl);
      overlay.appendChild(statusEl);
      inner.appendChild(v);
      inner.appendChild(overlay);
      item.appendChild(inner);
      dock.appendChild(item);

      // ALL dock tiles live (your requirement)
      attachStream(v, ch.url, statusEl, 'dock');

      item.addEventListener('click', () => loadHero(idx));
    });

    dockSummary.textContent = `${CHANNELS.length} channel${CHANNELS.length>1?'s':''} live in dock`;
  }

  function startWatchdog(){
    if (watchdogTimer) clearInterval(watchdogTimer);

    watchdogTimer = setInterval(() => {
      streams.forEach((st, video) => {
        // skip if restarting
        if (st.restarting) return;

        // only check if the video should be playing
        if (video.paused || video.ended) { st.strikes = 0; st.lastTime = video.currentTime; return; }

        // must have some data
        if (video.readyState < 2) return;

        const t = video.currentTime;

        if (t === st.lastTime) st.strikes++;
        else st.strikes = 0;

        st.lastTime = t;

        if (st.strikes >= CONFIG.WATCHDOG_STRIKES){
          st.strikes = 0;
          restartStream(video, 'Stalled…');
        }
      });
    }, CONFIG.WATCHDOG_INTERVAL_MS);
  }

  function init(){
    CHANNELS = CONFIG.channels.filter(c => c && isUrl(c.url));

    if (!CHANNELS.length){
      statusLabel.textContent = 'No valid channels configured';
      showBanner('Add at least one channel with a valid URL in CONFIG.channels.');
      return;
    }

    statusLabel.textContent = `Hero + dock • ${CHANNELS.length} channel(s)`;
    buildDock();
    loadHero(0);
    startWatchdog();
  }

  document.addEventListener('DOMContentLoaded', init);

  window.addEventListener('beforeunload', () => {
    if (heroRotateTimer) clearTimeout(heroRotateTimer);
    if (watchdogTimer) clearInterval(watchdogTimer);
    // unload all videos
    document.querySelectorAll('video').forEach(v => unload(v));
  });
</script>
</body>
</html>
