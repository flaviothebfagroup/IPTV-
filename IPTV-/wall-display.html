<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BFA IPTV — Multi Channel Wall</title>

<!-- hls.js for HLS playback on Chromium / BrightSign -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>

<style>
  :root{
    --brand:#ff6a00;
    --brand2:#e85f00;
    --fg:#0f172a;
    --muted:#94a3b8;
  }

  *{box-sizing:border-box;margin:0;padding:0;}
  html,body{
    width:100%;
    height:100%;
    overflow:hidden;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    background:#000;
    color:var(--fg);
  }

  /* Orange “neumorphism” background */
  body{
    background:
      radial-gradient(circle at top left,#ffe8c2 0%,#ffb86b 20%,#ff6a00 40%,#12060c 100%);
  }

  .page{
    position:relative;
    width:100%;
    height:100%;
    padding:12px;
  }

  /* Header */
  .brand-bar{
    position:absolute;
    left:12px;right:12px;top:8px;
    display:flex;justify-content:space-between;align-items:center;
    z-index:10;
  }
  .brand-left{
    display:flex;align-items:center;gap:10px;
  }
  .logo{
    width:40px;height:40px;border-radius:14px;
    box-shadow:0 10px 26px rgba(0,0,0,.4);
    background:#ff6a00;
  }
  .brand-text h1{
    margin:0;
    font-size:18px;
    font-weight:800;
    color:#fff;
    text-shadow:0 2px 6px rgba(0,0,0,.6);
  }
  .brand-text .sub{
    font-size:11px;
    color:#e5e7eb;
    opacity:.9;
  }

  .pill{
    padding:6px 12px;
    border-radius:999px;
    background:rgba(5,7,12,.86);
    border:1px solid rgba(255,255,255,.12);
    color:#e5e7eb;
    font-size:11px;
    display:inline-flex;
    align-items:center;
    gap:6px;
    box-shadow:0 10px 24px rgba(0,0,0,.45);
  }
  .pill-dot{
    width:8px;height:8px;border-radius:999px;background:#22c55e;
    box-shadow:0 0 0 0 rgba(34,197,94,.6);
    animation:pulse 1.6s infinite;
  }
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(34,197,94,.6);}
    70%{box-shadow:0 0 0 10px rgba(34,197,94,0);}
    100%{box-shadow:0 0 0 0 rgba(34,197,94,0);}
  }

  /* Grid area */
  .wall-grid{
    position:absolute;
    left:12px;right:12px;top:60px;bottom:12px;
    display:grid;
    gap:10px;
    align-items:start;
    justify-items:stretch;
  }

  /* === STRICT 16:9 TILES (works everywhere) === */
  .tile{
    position:relative;
    width:100%;
    height:0;
    padding-top:56.25%; /* 16:9 ratio */
    border-radius:20px;
    overflow:hidden;
    background:radial-gradient(circle at top,#111827,#020617);
    box-shadow:
      0 18px 40px rgba(0,0,0,.7),
      0 1px 0 rgba(255,255,255,.12);
    border:1px solid rgba(15,23,42,.7);
  }

  .tile-inner{
    position:absolute;
    inset:0;
  }

  .tile video{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    background:#000;
    display:block;
  }

  .tile-overlay{
    position:absolute;
    left:0;right:0;bottom:0;
    padding:6px 10px;
    background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.7) 55%,rgba(0,0,0,.95) 100%);
    display:flex;
    justify-content:space-between;
    align-items:center;
    color:#f9fafb;
    font-size:11px;
  }
  .tile-name{
    font-weight:600;
    max-width:70%;
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow:hidden;
  }
  .tile-status{
    font-size:10px;
    color:#cbd5f5;
    opacity:.9;
  }
  .tile-status.err{color:#fecaca;}
  .tile-status.idle{color:#9ca3af;}

  .err-banner{
    position:absolute;
    left:50%;bottom:10px;
    transform:translateX(-50%);
    background:rgba(239,68,68,.96);
    color:#fff;
    padding:6px 12px;
    border-radius:999px;
    font-size:11px;
    box-shadow:0 12px 28px rgba(0,0,0,.65);
    display:none;
    z-index:20;
  }
</style>
</head>
<body>
<div class="page">
  <header class="brand-bar">
    <div class="brand-left">
      <img class="logo" src="/IPTV-/icons/icon-192.png" alt="BFA logo"
           onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22 viewBox=%220 0 40 40%22%3E%3Crect width=%2240%22 height=%2240%22 rx=%2214%22 fill=%22%23ff6a00%22/%3E%3Ctext x=%2250%25%22 y=%2255%25%22 text-anchor=%22middle%22 font-size=%2213%22 font-family=%22system-ui%22 font-weight=%22800%22 fill=%22%23fff%22%3EBFA%3C/text%3E%3C/svg%3E';">
      <div class="brand-text">
        <h1>BFA IPTV — Multi Channel Wall</h1>
        <div class="sub">Up to 9 channels • fixed 16:9 tiles • HLS</div>
      </div>
    </div>
    <div class="pill">
      <span class="pill-dot"></span>
      <span id="statusLabel">Starting…</span>
    </div>
  </header>

  <main id="wallGrid" class="wall-grid"></main>
  <div id="errBanner" class="err-banner"></div>
</div>

<script>
  // ===============================
  // 1) SIMPLE CONFIG — EDIT ONLY HERE
  // ===============================
  const CONFIG = {
    // Put between 1 and 9 channels here.
    // name = label on screen, url = your m3u8 stream.
    channels: [
      {
        name: "News",
        url: "https://citynewsregional.akamaized.net/hls/live/1024052/Regional_Live_7/Video-2Mbps.m3u8"
      },
      {
        name: "Tennis Channel S",
        url: "https://amg01444-tennischannelth-tennischannelnl-samsungnl-x3dq1.amagi.tv/playlist/amg01444-tennischannelth-tennischannelnl-samsungnl/playlist.m3u8"
      },
      {
        name: "Cooking",
        url: "https://gusto-xumo.amagi.tv/playlist.m3u8"
      },
      {
        name: "Love Nature",
        url: "https://aegis-cloudfront-1.tubi.video/6d6d0f24-8445-4b4c-bdf6-44f9e38beaa4/playlist.m3u8"
      },
      {
        name: "Kids",
        url: "https://c0c65b821b3542c3a4dca92702f59944.mediatailor.us-east-1.amazonaws.com/v1/master/04fd913bb278d8775298c26fdca9d9841f37601f/RakutenTV-eu_BabySharkTV/playlist.m3u8"
      },
      {
      name: "TSN 5",
        url: "https://fl31.moveonjoy.com/TSN_5/index.m3u8"
      },
      // Add more if you want (up to 9 total):
      // { name:"Channel 6", url:"https://..." },
      // { name:"Channel 7", url:"https://..." },
      // { name:"Channel 8", url:"https://..." },
      // { name:"Channel 9", url:"https://..." },
    ]
  };

  const wallGrid    = document.getElementById('wallGrid');
  const statusLabel = document.getElementById('statusLabel');
  const errBanner   = document.getElementById('errBanner');

  function showBanner(msg){
    errBanner.textContent = msg;
    errBanner.style.display = 'block';
  }
  function hideBanner(){
    errBanner.style.display = 'none';
  }

  const isUrl = u => /^https?:\/\/\S+$/i.test((u||'').trim());

  // HLS attach helper
  function attachStream(video, url, statusEl){
    statusEl.textContent = 'Loading…';
    statusEl.className = 'tile-status';

    if (!isUrl(url)) {
      statusEl.textContent = 'No URL';
      statusEl.classList.add('err');
      return;
    }

    // HLS.js path (Chromium / BrightSign)
    if (window.Hls && Hls.isSupported()) {
      const hls = new Hls({
        enableWorker:true,
        lowLatencyMode:true
      });
      hls.loadSource(url);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        video.play().then(()=>{
          statusEl.textContent = 'LIVE';
        }).catch(err=>{
          console.warn('Autoplay blocked', err);
          statusEl.textContent = 'Tap to play';
          statusEl.classList.add('idle');
        });
      });

      hls.on(Hls.Events.ERROR, (_, data) => {
        if (data && data.fatal) {
          console.error('Fatal HLS error', data);
          statusEl.textContent = 'Stream error';
          statusEl.classList.add('err');
        }
      });
    }
    // Native HLS (Safari / some engines)
    else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = url;
      video.play().then(()=>{
        statusEl.textContent = 'LIVE';
      }).catch(err=>{
        console.warn('Autoplay blocked (native)', err);
        statusEl.textContent = 'Tap to play';
        statusEl.classList.add('idle');
      });
    }
    // Fallback
    else {
      video.src = url;
      statusEl.textContent = 'HLS not supported';
      statusEl.classList.add('err');
    }

    video.onerror = () => {
      statusEl.textContent = 'Video error';
      statusEl.classList.add('err');
    };
  }

  // Choose a layout (cols x rows) based on number of channels + screen size
  function pickLayout(count){
    const maxCols = 4;   // allow 4x3 if needed to fit
    const maxRows = 4;
    const gap = 10;

    const availW = window.innerWidth  - 24;     // padding left/right
    const availH = window.innerHeight - (60+12); // header + bottom pad

    const candidates = [];
    for(let cols=1; cols<=maxCols; cols++){
      const rows = Math.ceil(count/cols);
      if(rows>maxRows) continue;
      const tileW = (availW - gap*(cols-1)) / cols;
      const tileH = tileW * 9/16;
      const totalH = tileH*rows + gap*(rows-1);
      candidates.push({cols,rows,totalH,tileH});
    }

    // First, layouts that fit in height
    const fitting = candidates.filter(c => c.totalH <= availH);
    if (fitting.length){
      // Choose the one with biggest tiles (largest tileH)
      fitting.sort((a,b)=>b.tileH-a.tileH);
      return fitting[0];
    }

    // If none fit, pick the one with smallest overflow
    candidates.sort((a,b)=>a.totalH-b.totalH);
    return candidates[0] || {cols:count,rows:1};
  }

  function buildWall(){
    hideBanner();
    const channels = CONFIG.channels.filter(c => c && isUrl(c.url));
    const n = channels.length;

    if (!n) {
      statusLabel.textContent = 'No channels configured';
      showBanner('Add at least one channel in CONFIG.channels (name + url).');
      wallGrid.innerHTML = '';
      return;
    }

    const layout = pickLayout(Math.min(n,9));
    const cols = layout.cols;
    const rows = layout.rows;
    const totalSlots = cols * rows;

    wallGrid.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
    wallGrid.innerHTML = '';

    for (let i = 0; i < totalSlots; i++) {
      const ch = channels[i] || null;

      const tile   = document.createElement('section');
      tile.className = 'tile';

      const inner = document.createElement('div');
      inner.className = 'tile-inner';

      const video  = document.createElement('video');
      video.autoplay   = true;
      video.muted      = true;
      video.playsInline = true;

      const overlay   = document.createElement('div');
      overlay.className = 'tile-overlay';

      const nameEl    = document.createElement('div');
      nameEl.className = 'tile-name';

      const statusEl  = document.createElement('div');
      statusEl.className = 'tile-status';

      if (ch) {
        nameEl.textContent = ch.name || 'Channel';
        attachStream(video, ch.url, statusEl);
      } else {
        nameEl.textContent = 'Empty';
        statusEl.textContent = '';
        statusEl.classList.add('idle');
      }

      overlay.appendChild(nameEl);
      overlay.appendChild(statusEl);
      inner.appendChild(video);
      inner.appendChild(overlay);
      tile.appendChild(inner);
      wallGrid.appendChild(tile);
    }

    statusLabel.textContent = `Showing ${Math.min(n,totalSlots)} channel(s) • Layout ${cols} × ${rows}`;
  }

  document.addEventListener('DOMContentLoaded', buildWall);
  window.addEventListener('resize', () => {
    // Rebuild on resize to keep tiles nicely fitted
    buildWall();
  });
</script>
</body>
</html>
