<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sales Pinboard — 1920×1080</title>
  <style>
    :root{
      --bg:#f1f2f4; --panel:#fff; --ink:#0b0b0c; --muted:#6e6e73;
      --line:#d0d3d9; --line-strong:#aeb3bb;
      --green:#1a7f37; --blue:#1b59d1; --red:#c42b2b;
      --roleW: 220px;      /* left name col */
      --periodW: 70px;     /* MTD/YTD col */
      --cellW: 44px;       /* JS recalculates so everything fits */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--ink); background:#0f1114; display:grid; place-items:center;
    }

    /* 1920×1080 stage */
    .stage{width:1920px; height:1080px; background:var(--panel); border-radius:14px;
      box-shadow:0 40px 80px rgba(0,0,0,.45); display:flex; flex-direction:column; overflow:hidden}
    .chrome{display:flex; align-items:center; gap:16px; padding:10px 14px 6px; border-bottom:1px solid var(--line);
      background:linear-gradient(#fbfbfd,#f5f6f8)}
    .title{font-weight:700}
    .spacer{flex:1}
    .asof{font-size:13px; color:var(--muted)}

    /* Legend */
    .legend{display:flex; gap:18px; align-items:center; padding:8px 14px 12px}
    .tag{display:inline-flex; align-items:center; gap:6px; font-size:13px; color:#374151}
    .dot{width:14px; height:14px; border-radius:4px; border:1px solid var(--line-strong)}
    .dot.green{background:#e8f5ec; border-color:#b7e2c7}
    .dot.blue{background:#e7efff; border-color:#c2d5ff}
    .dot.red{background:#f7e9ea; border-color:#f0c9cd}

    /* Board */
    .board{flex:1; padding:12px 14px 14px; background:var(--bg)}
    .frame{height:100%; border:1px solid var(--line); border-radius:14px; background:#fff; box-shadow:0 10px 28px rgba(0,0,0,.07); overflow:hidden}
    table{border-collapse:separate; border-spacing:0; width:100%; table-layout:fixed}
    thead th{position:sticky; top:0; z-index:2; background:linear-gradient(#fbfbfc,#f5f6f8);}
    th, td{border-right:1px solid var(--line); border-bottom:1px solid var(--line)}
    th:first-child, td:first-child{border-left:1px solid var(--line)}
    th, td{padding:6px 8px; text-align:center}
    th{font-weight:600; color:#263238; font-size:13px}
    tbody td{height:32px; background:#fff; overflow:hidden}
    tbody tr:nth-child(odd) td{background:#fcfdff}

    /* sticky left cols */
    .name{position:sticky; left:0; z-index:1; background:inherit; text-align:left; font-weight:600; width:var(--roleW); cursor:pointer}
    .period{position:sticky; left:var(--roleW); z-index:1; background:inherit; width:var(--periodW); font-weight:600; color:#374151}

    /* day widths (set by JS) */
    .daynum, td.cell, td.total {width:var(--cellW)}
    .today{background:#fff7ea !important}

    /* pills — never wrap; empty pills hidden; auto-squish classes */
    .pills{display:flex; justify-content:center; align-items:center; gap:6px; flex-wrap:nowrap; white-space:nowrap}
    .pill{height:18px; padding:0 6px; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; font-size:12px; border:1px solid transparent}
    .pill:empty{display:none}                 /* hide empties */
    .pill.g{color:var(--green); background:#e8f5ec; border-color:#b7e2c7}
    .pill.b{color:var(--blue);  background:#e7efff; border-color:#c2d5ff}
    .pill.wt{color:var(--red);   background:#f7e9ea; border-color:#f0c9cd}
    .pills.squish  {gap:4px}
    .pills.squish  .pill{font-size:11px; padding:0 5px}
    .pills.xs      {gap:2px}
    .pills.xs      .pill{font-size:10px; padding:0 3px}
    .pills.xxs     {gap:1px}
    .pills.xxs     .pill{font-size:9px;  padding:0 2px}

    td.total{font-weight:700; background:#fbfbfd}

    /* Editor (G/B/WT) */
    .editor{
      position:fixed; left:24px; top:24px; width:380px; background:#fff; border:1px solid var(--line);
      border-radius:12px; padding:12px; box-shadow:0 14px 36px rgba(0,0,0,.18); display:none; z-index:50
    }
    .editor h3{margin:0 0 10px; font-size:14px}
    .rows{display:grid; grid-template-columns:28px 1fr 110px; gap:10px 8px; align-items:center}
    .chip{min-width:22px; height:18px; padding:0 4px; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; font-size:12px; border:1px solid transparent}
    .chip.g{color:var(--green); background:#e8f5ec; border-color:#b7e2c7}
    .chip.b{color:var(--blue);  background:#e7efff; border-color:#c2d5ff}
    .chip.wt{color:var(--red);  background:#f7e9ea; border-color:#f0c9cd}
    .rows label{font-weight:600; color:#2f2f31; text-align:left}
    .rows input{width:100%; padding:6px 8px; border:1px solid var(--line-strong); border-radius:8px}
    .rows input[type=number]::-webkit-outer-spin-button,
    .rows input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
    .rows input[type=number]{ -moz-appearance:textfield }

    .foot{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
    .btn{appearance:none; border:1px solid var(--line-strong); background:#fff; padding:8px 10px; border-radius:10px; font-weight:600; cursor:pointer}
    .btn.primary{border-color:#0b6bcb; background:#0b6bcb; color:#fff}

    /* Names manager inside editor */
    details.nameMgr{margin-top:10px; border-top:1px solid var(--line); padding-top:10px}
    details.nameMgr summary{cursor:pointer; font-weight:600; color:#2f2f31}
    .nameRow{display:grid; grid-template-columns:1fr auto auto; gap:8px; margin-top:8px}
    .nameRow input{padding:6px 8px; border:1px solid var(--line-strong); border-radius:8px}

    .toolbar{display:none}
  </style>
</head>
<body>
  <div class="stage">
    <div class="chrome">
      <div class="title">Sales Pinboard</div>
      <div class="spacer"></div>
      <div class="asof" id="asof">—</div>
    </div>

    <div class="legend">
      <span class="tag"><span class="dot green"></span> New Car</span>
      <span class="tag"><span class="dot blue"></span> Pre-Owned</span>
      <span class="tag"><span class="dot red"></span> Winter Tire</span>
    </div>

    <div class="board">
      <div class="frame">
        <table id="grid"></table>
      </div>
    </div>
  </div>

  <!-- Editor -->
  <div class="editor" id="editor" role="dialog" aria-modal="true">
    <h3 id="editorTitle">Edit</h3>
    <div class="rows">
      <div class="chip g">G</div><label for="inG">New</label><input id="inG" type="number" min="0" step="1" />
      <div class="chip b">B</div><label for="inB">Pre-Owned</label><input id="inB" type="number" min="0" step="1" />
      <div class="chip wt">WT</div><label for="inW">WT</label><input id="inW" type="number" min="0" step="1" />
    </div>

    <details class="nameMgr" id="nameMgr">
      <summary>Manage names</summary>
      <div class="nameRow">
        <input id="nameField" placeholder="Type a name…" />
        <button class="btn" id="addNameBtn" type="button">Add</button>
        <button class="btn" id="renameBtn" type="button">Rename selected</button>
      </div>
    </details>

    <div class="foot">
      <button class="btn" id="cancelEdit" type="button">Cancel</button>
      <button class="btn primary" id="saveEdit" type="button">Save</button>
    </div>
  </div>

  <script>
  // ===== Data (MTD/YTD rows, Lease removed) =====
  const STORAGE_KEY = 'sales-pinboard-1080-v4';
  const defaultTeam = ['Yassir','Sumit','Connor','Mohamad','Jerry','Brittany','Arnold','House'];
  const today = new Date();
  const state = {
    year: today.getFullYear(),
    month: today.getMonth(), // 0-11
    names: [...defaultTeam],
    data: {} // data[name].MTD[day] = {g,b,w}, data[name].YTD[day] = {g,b,w}
  };

  try { const saved = JSON.parse(localStorage.getItem(STORAGE_KEY)||'null'); if (saved) Object.assign(state, saved); } catch {}

  function daysInMonth(y,m){ return new Date(y,m+1,0).getDate(); }

  function ensureSkeleton(){
    const dim = daysInMonth(state.year, state.month);
    if (!state.names?.length) state.names = [...defaultTeam];
    state.data = state.data || {};
    for (const n of state.names){
      state.data[n] = state.data[n] || { MTD:{}, YTD:{} };
      for (const row of ['MTD','YTD']){
        for (let d=1; d<=dim; d++){
          state.data[n][row][d] = state.data[n][row][d] || {g:0,b:0,w:0};
        }
        for (const k of Object.keys(state.data[n][row])) {
          const day = Number(k); if (day>dim) delete state.data[n][row][k];
        }
      }
    }
  }

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); renderAsOf(); }

  const gridEl = document.getElementById('grid');

  function render(){
    ensureSkeleton();
    const dim = daysInMonth(state.year, state.month);
    const monthName = new Date(state.year, state.month, 1).toLocaleString(undefined,{month:'long'});

    // Compute cell width to fill 1920 with no horizontal scroll
    const stageInner = 1920 - 2*14; // side padding in .board
    const fixed = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--roleW')) +
                  parseInt(getComputedStyle(document.documentElement).getPropertyValue('--periodW'));
    const cols = dim + 1; // days + Total
    const cellW = Math.max(34, Math.floor((stageInner - fixed - 2) / cols));
    document.documentElement.style.setProperty('--cellW', cellW + 'px');

    let html = '';
    html += '<thead><tr>';
    html += `<th class="name">Sales Specialist — ${monthName}</th>`;
    html += `<th class="period">&nbsp;</th>`;
    for (let d=1; d<=dim; d++){
      const isToday = (state.year===today.getFullYear() && state.month===today.getMonth() && d===today.getDate());
      html += `<th class="daynum${isToday?' today':''}">${d}</th>`;
    }
    html += `<th>Total</th>`;
    html += '</tr></thead>';

    html += '<tbody>';
    for (const name of state.names){
      let first = true;
      for (const row of ['MTD','YTD']){
        html += '<tr>';
        if (first){ html += `<td class="name nameCell" data-name="${encodeURIComponent(name)}" rowspan="2" title="Click to rename">${name}</td>`; first=false; }
        html += `<td class="period">${row}</td>`;
        let sum=0;
        for (let d=1; d<=dim; d++){
          const v = state.data[name][row][d] || {g:0,b:0,w:0};
          sum += (v.g|0) + (v.b|0) + (v.w|0);
          const isToday = (state.year===today.getFullYear() && state.month===today.getMonth() && d===today.getDate());
          html += `<td class="cell${isToday?' today':''}" data-name="${encodeURIComponent(name)}" data-row="${row}" data-day="${d}">
            <div class="pills">
              <span class="pill g">${v.g||''}</span>
              <span class="pill b">${v.b||''}</span>
              <span class="pill wt">${v.w||''}</span>
            </div>
          </td>`;
        }
        html += `<td class="total">${sum}</td>`;
        html += '</tr>';
      }
    }
    html += '</tbody>';

    gridEl.innerHTML = html;

    // Fit pills per cell so they never wrap/overflow
    fitAllCells();

    // click-to-edit day cells
    gridEl.querySelectorAll('td.cell').forEach(td=>{
      td.addEventListener('click', (ev)=> openEditor(td, ev));
    });

    // click-to-rename name cells
    gridEl.querySelectorAll('td.nameCell').forEach(td=>{
      td.addEventListener('click', ()=> openRenameFromName(td));
    });
  }

  function fitAllCells(){
    const cells = gridEl.querySelectorAll('td.cell');
    cells.forEach(td=>{
      const pills = td.querySelector('.pills');
      if (!pills) return;
      pills.classList.remove('squish','xs','xxs');
      const max = td.clientWidth - 6;
      if (pills.scrollWidth > max) pills.classList.add('squish');
      if (pills.scrollWidth > max) pills.classList.add('xs');
      if (pills.scrollWidth > max) pills.classList.add('xxs');
    });
  }

  function renderAsOf(){
    const el = document.getElementById('asof');
    const d = new Date();
    const ts = d.toLocaleString(undefined,{ hour:'numeric', minute:'2-digit'}) +
               ' on ' + d.toLocaleDateString(undefined,{year:'numeric', month:'long', day:'numeric'});
    el.textContent = `Information current as of ${ts}`;
  }

  // ===== Editor (G/B/WT) with add/rename names =====
  const editor = document.getElementById('editor');
  const inG = document.getElementById('inG');
  const inB = document.getElementById('inB');
  const inW = document.getElementById('inW');
  const editorTitle = document.getElementById('editorTitle');
  const nameField = document.getElementById('nameField');
  const nameMgr = document.getElementById('nameMgr');
  let current = null;
  let renameTarget = null; // if set, renameBtn renames this name

  function placeEditorNear(el){
    editor.style.display = 'block';
    requestAnimationFrame(()=>{
      const rect = el.getBoundingClientRect();
      const stageRect = document.querySelector('.stage').getBoundingClientRect();
      let left = Math.min(stageRect.right - editor.offsetWidth - 12, rect.left + 8);
      let top  = Math.min(stageRect.bottom - editor.offsetHeight - 12, rect.bottom + 8);
      left = Math.max(stageRect.left + 12, left);
      top  = Math.max(stageRect.top + 12, top);
      editor.style.left = left + 'px';
      editor.style.top  = top  + 'px';
    });
  }

  function openEditor(td){
    const name = decodeURIComponent(td.dataset.name);
    const row = td.dataset.row;
    const day = Number(td.dataset.day);
    const v = state.data[name][row][day] || {g:0,b:0,w:0};
    inG.value = v.g||0; inB.value = v.b||0; inW.value = v.w||0;
    editorTitle.textContent = `Edit — ${name} • ${row} • Day ${day}`;
    current = {name,row,day};
    renameTarget = null;                 // editing numbers, not renaming
    nameMgr.open = false;
    placeEditorNear(td);
    inG.focus(); inG.select();
  }

  function openRenameFromName(td){
    const name = decodeURIComponent(td.dataset.name);
    current = {name,row:'MTD',day:1};    // dummy context
    renameTarget = name;                 // explicit rename target
    nameField.value = name;
    editorTitle.textContent = `Rename — ${name}`;
    nameMgr.open = true;                 // show manager
    placeEditorNear(td);
    nameField.focus(); nameField.select();
  }

  document.getElementById('cancelEdit').onclick = ()=>{ editor.style.display = 'none'; renameTarget = null; };
  document.getElementById('saveEdit').onclick = saveEditor;
  function saveEditor(){
    if (!current) return;
    state.data[current.name][current.row][current.day] = {
      g: Number(inG.value||0),
      b: Number(inB.value||0),
      w: Number(inW.value||0)
    };
    save(); render(); editor.style.display = 'none';
  }

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if (editor.style.display === 'block'){
      if (e.key === 'Escape'){ editor.style.display = 'none'; renameTarget = null; }
      if (e.key === 'Enter' && !nameMgr.open){ saveEditor(); }
    }
  });

  // Names manager
  document.getElementById('addNameBtn').onclick = ()=>{
    const nm = (nameField.value||'').trim();
    if (!nm) return;
    if (state.names.includes(nm)) { alert('Name already exists.'); return; }
    state.names.push(nm);
    ensureSkeleton(); save(); render();
    nameField.value = '';
  };
  document.getElementById('renameBtn').onclick = ()=>{
    const nm = (nameField.value||'').trim();
    const src = renameTarget || (current && current.name);
    if (!nm || !src) return;
    if (state.names.includes(nm)) { alert('Name already exists.'); return; }
    const idx = state.names.indexOf(src);
    if (idx>=0){
      state.names[idx] = nm;
      state.data[nm] = state.data[src];
      delete state.data[src];
      if (current) current.name = nm;
      if (renameTarget) renameTarget = nm;
      save(); render();
      nameField.value = '';
    }
  };

  // Boot
  renderAsOf();
  render();
  </script>
</body>
</html>
