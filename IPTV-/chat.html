<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>BFA Support</title>

<!-- Optional: helps some networks resolve faster -->
<link rel="preconnect" href="https://js-na3.hs-scripts.com" crossorigin>
<link rel="preconnect" href="https://js.hs-scripts.com" crossorigin>
<link rel="preconnect" href="https://js.hs-analytics.net" crossorigin>
<link rel="preconnect" href="https://api.usemessages.com" crossorigin>

<style>
  :root{
    --accent:#ff9500;

    --bg-start:#fff4e4;
    --bg-mid:#ffd293;
    --bg-end:#ff9500;

    --fg:#111;
    --muted:#6e6e73;

    --panel:rgba(255,255,255,.58);
    --tile:rgba(255,255,255,.46);
    --tileHover:rgba(255,149,0,.08);

    --border:rgba(15,23,42,.10);
    --borderStrong:rgba(15,23,42,.18);
    --shadow:0 14px 34px rgba(15,23,42,.08), 0 2px 8px rgba(15,23,42,.05);

    --glass-blur:16px;
    --glass-sat:140%;
  }
  body.dark{
    --bg-start:#0b0c10;
    --bg-mid:#0d1016;
    --bg-end:#10141b;

    --fg:#f7f7f8;
    --muted:#a1a1a8;

    --panel:rgba(21,21,23,.56);
    --tile:rgba(26,26,29,.50);
    --tileHover:rgba(255,149,0,.10);

    --border:rgba(255,255,255,.10);
    --borderStrong:rgba(255,255,255,.20);
    --shadow:0 18px 46px rgba(0,0,0,.36), 0 2px 8px rgba(0,0,0,.22);

    --glass-blur:14px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--fg);
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif;
    background:transparent;
  }
  body::before{
    content:"";
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:linear-gradient(180deg,var(--bg-start) 0%, var(--bg-mid) 52%, var(--bg-end) 100%);
  }

  /* Topbar */
  .topbar{
    position:sticky;top:0;z-index:100;background:var(--panel);
    border-bottom:1px solid var(--border);
    padding:calc(10px + env(safe-area-inset-top,0)) 14px 10px;
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
  }
  .toprow{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:10px}
  .brand{display:flex;align-items:center;gap:10px;min-width:0}
  .logo{
    width:32px;height:32px;border-radius:9px;border:1px solid var(--border);
    background:#fff center/cover no-repeat;
    flex:0 0 auto;
  }
  .logotxt{font-weight:950;letter-spacing:.2px;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .actions{margin-left:auto;display:flex;gap:8px;align-items:center}

  .chip{
    height:38px;min-width:38px;padding:0 14px;border-radius:9999px;border:1.5px solid var(--borderStrong);
    background:var(--tile);color:var(--fg);font-weight:950;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
    transition:transform .12s ease, filter .18s ease, border-color .18s ease;
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-tap-highlight-color:transparent;
  }
  .chip:hover{border-color:var(--accent);transform:translateY(-1px);filter:brightness(1.03)}
  .chip.accent{background:transparent;border-color:var(--accent);color:var(--accent)}
  .ic{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}

  /* Card */
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .card{
    background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    overflow:hidden;
  }
  .card-head{
    padding:16px;
    border-bottom:1px solid var(--border);
    display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
    background:linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0));
  }
  body.dark .card-head{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0))}
  .hgroup{min-width:0}
  .h1{
    margin:0;font-size:26px;font-weight:1000;letter-spacing:.2px;
    display:flex;align-items:center;gap:10px
  }
  .desc{margin-top:8px;color:var(--muted);font-size:13px;line-height:1.35}

  .badge{
    display:inline-flex;align-items:center;gap:10px;
    padding:10px 14px;border-radius:999px;
    border:1px solid var(--borderStrong);
    background:var(--tile);
    font-weight:950;
    white-space:nowrap;
  }
  .badgeDot{width:10px;height:10px;border-radius:99px;background:#22c55e;display:inline-block}

  .card-body{
    position:relative;
    padding:0;
    background:transparent;
  }

  /* Desktop inline embed mount */
  #hsMount{
    width:100%;
    height:calc(100vh - 260px);
    min-height:560px;
    max-height:860px;
  }

  /* Force HubSpot inline containers to fill */
  #hubspot-conversations-inline-parent{
    width:100% !important;
    height:100% !important;
    min-height:inherit !important;
    max-height:inherit !important;
  }
  #hubspot-conversations-inline-iframe{
    width:100% !important;
    height:100% !important;
    border:0 !important;
    display:block !important;
    background:transparent !important;
  }

  /* Mobile CTA (instead of blank embed area) */
  .mobileCta{
    display:none;
    padding:22px 16px 18px;
  }
  .ctaBox{
    max-width:520px;margin:0 auto;
    background:var(--tile);
    border:1px solid var(--borderStrong);
    border-radius:18px;
    padding:16px;
    box-shadow:0 10px 28px rgba(15,23,42,.08);
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
  }
  .ctaTitle{font-weight:1000;font-size:16px;margin:0 0 6px}
  .ctaText{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
  .ctaBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .ctaBtn{
    height:42px;padding:0 14px;border-radius:999px;border:1.5px solid var(--borderStrong);
    background:#fff;color:#111;font-weight:1000;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
  }
  body.dark .ctaBtn{background:#111;color:#fff}
  .ctaBtn.primary{border-color:var(--accent);color:var(--accent);background:transparent}

  .toast{
    position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
    background:var(--accent);color:#000;padding:10px 16px;border-radius:999px;font-weight:1000;
    opacity:0;transition:opacity .25s;pointer-events:none;z-index:999;
    box-shadow:0 10px 26px rgba(0,0,0,.18);
    max-width:min(92vw,520px);
    text-align:center;
  }
  .toast.show{opacity:1}
  .toast.err{background:#ff453a;color:#fff}

  @media (max-width:760px){
    .wrap{padding:14px}
    .h1{font-size:22px}

    /* On mobile: hide inline embed area, show CTA */
    #hsMount{display:none}
    .mobileCta{display:block}
  }

  a:focus-visible,button:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
</style>

<script>
  // =====================
  // HubSpot config (must be set BEFORE loading the script)
  // =====================
  const HS_PORTAL_ID = "342895404";
  const HS_HUBLET = "na3";

  const isMobile = () =>
    (window.matchMedia && matchMedia("(max-width:760px)").matches) ||
    /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  window.hsConversationsSettings = {
    loadImmediately: false
  };

  if (!isMobile()) {
    // IMPORTANT: set this before loading the script so inline embed works reliably
    window.hsConversationsSettings.inlineEmbedSelector = "#hsMount";
  }

  function toast(msg, err=false){
    const t=document.getElementById("toast");
    t.textContent=msg;
    t.classList.toggle("err", !!err);
    t.classList.add("show");
    clearTimeout(toast._t);
    toast._t=setTimeout(()=>t.classList.remove("show"), 2800);
  }

  function setTheme(next){
    document.body.classList.toggle("dark", next==="dark");
    localStorage.setItem("bfa_support_theme", next);
  }
  function initTheme(){
    const saved = localStorage.getItem("bfa_support_theme");
    if (saved) setTheme(saved);
    else if (window.matchMedia && matchMedia("(prefers-color-scheme: dark)").matches) setTheme("dark");
  }

  function hsReady(){
    return !!(window.HubSpotConversations && window.HubSpotConversations.widget);
  }

  function openChat(){
    if (!hsReady()) return false;
    try{
      window.HubSpotConversations.widget.load({ widgetOpen:true });
      window.HubSpotConversations.widget.open();
      return true;
    }catch(e){ return false; }
  }

  function retryChat(){
    if (!hsReady()) return false;
    try{
      window.HubSpotConversations.widget.refresh({ openToNewThread:false });
      window.HubSpotConversations.widget.open();
      return true;
    }catch(e){ return false; }
  }

  function newChat(){
    if (!hsReady()) return false;
    try{
      window.HubSpotConversations.clear({ resetWidget:true });
      setTimeout(()=>openChat(), 250);
      return true;
    }catch(e){ return false; }
  }

  // Load script with fallback (some blockers hit one domain but not the other)
  function loadScriptWithFallback(urls){
    return new Promise((resolve,reject)=>{
      let i = 0;
      const tryNext = () => {
        if (i >= urls.length) return reject(new Error("HubSpot script blocked"));
        const src = urls[i++];
        const s = document.createElement("script");
        s.async = true; s.defer = true;
        s.src = src;
        s.onload = () => resolve(src);
        s.onerror = () => tryNext();
        document.head.appendChild(s);
      };
      tryNext();
    });
  }

  async function bootHubSpot(){
    // Note: HubSpot loader and chat can involve multiple domains (tracking + chat).
    const urls = [
      `https://js-${HS_HUBLET}.hs-scripts.com/${HS_PORTAL_ID}.js`,
      `https://js.hs-scripts.com/${HS_PORTAL_ID}.js`
    ];

    try{
      await loadScriptWithFallback(urls);

      // Wait for widget to exist
      const start = Date.now();
      while (!hsReady() && Date.now() - start < 12000){
        await new Promise(r=>setTimeout(r, 200));
      }
      if (!hsReady()){
        toast("HubSpot loaded, but chat widget didn’t initialize.", true);
        return;
      }

      // Open immediately (mobile will go full-screen overlay)
      openChat();

    }catch(e){
      toast("HubSpot is blocked on this phone (Content Blocker / AdBlock DNS).", true);

      // Helpful note inside the page (mobile)
      const note = document.getElementById("blockerNote");
      if (note){
        note.textContent =
          "Looks like HubSpot is blocked on this device/network. Disable Safari content blockers or allowlist: js-na3.hs-scripts.com, js.hs-scripts.com, js.hs-analytics.net, api.usemessages.com";
      }
    }
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    initTheme();

    document.getElementById("btnTheme").addEventListener("click", ()=>{
      const dark = document.body.classList.contains("dark");
      setTheme(dark ? "light" : "dark");
    });
    document.getElementById("btnRetry").addEventListener("click", ()=>{
      if (!retryChat()) toast("Chat not ready yet…", true);
      else toast("Retrying…");
    });
    document.getElementById("btnNew").addEventListener("click", ()=>{
      if (!newChat()) toast("Chat not ready yet…", true);
      else toast("New chat started");
    });

    // Mobile CTA buttons
    const openBtn = document.getElementById("btnOpenMobile");
    if (openBtn){
      openBtn.addEventListener("click", ()=>{
        if (!openChat()) toast("Chat not ready yet…", true);
      });
    }
    const retryBtn = document.getElementById("btnRetryMobile");
    if (retryBtn){
      retryBtn.addEventListener("click", ()=>{
        if (!retryChat()) toast("Chat not ready yet…", true);
      });
    }

    bootHubSpot();

    document.addEventListener("visibilitychange", ()=>{
      if (!document.hidden) openChat();
    });
  });
</script>
</head>

<body>
  <div class="topbar">
    <div class="toprow">
      <div class="brand">
        <div class="logo" style="background-image:url('/IPTV-/icons/icon-192.png')"></div>
        <div class="logotxt">BFA Support</div>
      </div>

      <div class="actions">
        <button class="chip" id="btnNew" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14"/></svg>
          New
        </button>
        <button class="chip" id="btnRetry" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/></svg>
          Retry
        </button>
        <button class="chip accent" id="btnTheme" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.8A9 9 0 1 1 11.2 3a7 7 0 0 0 9.8 9.8Z"/></svg>
          Theme
        </button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="card-head">
        <div class="hgroup">
          <div class="h1">
            Live Chat Support
            <svg class="ic" viewBox="0 0 24 24" aria-hidden="true" style="stroke:var(--accent)">
              <path d="M4 12a8 8 0 0 1 16 0v5a2 2 0 0 1-2 2h-2"/>
              <path d="M4 12v5a2 2 0 0 0 2 2h2"/>
              <path d="M8 19a4 4 0 0 0 4 2h2"/>
            </svg>
          </div>
          <div class="desc">
            We usually reply quickly during business hours. On mobile, tap <b>Open chat</b> if it doesn’t open automatically.
          </div>
        </div>
        <div class="badge">
          <span class="badgeDot"></span>
          Support Online
        </div>
      </div>

      <div class="card-body">
        <!-- Desktop inline embed -->
        <div id="hsMount"></div>

        <!-- Mobile CTA (clean, centered, no “box-in-box”) -->
        <div class="mobileCta">
          <div class="ctaBox">
            <p class="ctaTitle">Open BFA Support Chat</p>
            <p class="ctaText" id="blockerNote">
              If the chat doesn’t appear, tap Open chat. If it still fails, your phone/network is blocking HubSpot scripts.
            </p>
            <div class="ctaBtns">
              <button class="ctaBtn primary" id="btnOpenMobile" type="button">
                <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 12a8 8 0 0 1 16 0v5a2 2 0 0 1-2 2h-2"/><path d="M8 19a4 4 0 0 0 4 2h2"/></svg>
                Open chat
              </button>
              <button class="ctaBtn" id="btnRetryMobile" type="button">
                <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/></svg>
                Retry
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>
</body>
</html>
