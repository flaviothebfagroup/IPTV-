<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>BFA Support</title>

<link rel="preconnect" href="https://js-na3.hs-scripts.com" crossorigin>
<link rel="preconnect" href="https://js.hs-scripts.com" crossorigin>
<link rel="preconnect" href="https://js.hs-analytics.net" crossorigin>
<link rel="preconnect" href="https://api.usemessages.com" crossorigin>

<style>
  :root{
    --accent:#ff9500;
    --bg-start:#fff4e4;
    --bg-mid:#ffd293;
    --bg-end:#ff9500;
    --fg:#111;
    --muted:#6e6e73;
    --panel:rgba(255,255,255,.58);
    --tile:rgba(255,255,255,.46);
    --tileHover:rgba(255,149,0,.08);
    --border:rgba(15,23,42,.10);
    --borderStrong:rgba(15,23,42,.18);
    --shadow:0 14px 34px rgba(15,23,42,.08), 0 2px 8px rgba(15,23,42,.05);
    --glass-blur:16px;
    --glass-sat:140%;

    /* ✅ NEW: how tall the HubSpot promo cover should be */
    --hs-mask-h: 50px;
  }
  body.dark{
    --bg-start:#0b0c10;
    --bg-mid:#0d1016;
    --bg-end:#10141b;
    --fg:#f7f7f8;
    --muted:#a1a1a8;
    --panel:rgba(21,21,23,.56);
    --tile:rgba(26,26,29,.50);
    --tileHover:rgba(255,149,0,.10);
    --border:rgba(255,255,255,.10);
    --borderStrong:rgba(255,255,255,.20);
    --shadow:0 18px 46px rgba(0,0,0,.36), 0 2px 8px rgba(0,0,0,.22);
    --glass-blur:14px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--fg);
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif;
    background:transparent;
    -webkit-text-size-adjust:100%;
  }
  body::before{
    content:"";
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:linear-gradient(180deg,var(--bg-start) 0%, var(--bg-mid) 52%, var(--bg-end) 100%);
  }

  /* Topbar */
  .topbar{
    position:sticky;top:0;z-index:100;background:var(--panel);
    border-bottom:1px solid var(--border);
    padding:calc(10px + env(safe-area-inset-top,0)) 14px 10px;
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
  }
  .toprow{
    max-width:1100px;margin:0 auto;
    display:flex;align-items:center;gap:12px;
  }
  .brand{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
  .logo{
    width:32px;height:32px;border-radius:9px;border:1px solid var(--border);
    background:#fff center/cover no-repeat;flex:0 0 auto;
  }
  .logotxt{
    font-weight:950;letter-spacing:.2px;font-size:18px;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }

  .actions{display:flex;gap:8px;align-items:center}
  .chip{
    height:38px;min-width:38px;padding:0 14px;border-radius:9999px;border:1.5px solid var(--borderStrong);
    background:var(--tile);color:var(--fg);font-weight:950;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
    transition:transform .12s ease, filter .18s ease, border-color .18s ease;
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-tap-highlight-color:transparent;
    touch-action:manipulation;
  }
  .chip:hover{border-color:var(--accent);transform:translateY(-1px);filter:brightness(1.03)}
  .chip.accent{background:transparent;border-color:var(--accent);color:var(--accent)}
  .ic{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}

  /* Simple hamburger — RIGHT side */
  #hamburger{
    display:none;
    margin-left:auto;
    width:44px;height:44px;
    border:0;background:transparent;
    color:var(--accent);
    align-items:center;justify-content:center;
    cursor:pointer;
    touch-action:manipulation;
    -webkit-tap-highlight-color:transparent;
  }
  #hamburger svg{width:24px;height:24px;stroke:var(--accent);stroke-width:2.6;fill:none}

  @media (max-width:760px){
    .actions{display:none;}
    #hamburger{display:inline-flex;}
  }

  /* Page content */
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  @media (max-width:760px){.wrap{padding:14px}}

  .card{
    background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    overflow:hidden;
    display:flex;flex-direction:column;
    min-height:calc(100svh - 120px);
  }

  .card-head{
    padding:16px;
    border-bottom:1px solid var(--border);
    display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
    background:linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0));
    flex-shrink:0;
  }
  body.dark .card-head{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0))}

  .hgroup{min-width:0}
  .h1{
    margin:0;font-size:26px;font-weight:1000;letter-spacing:.2px;
    display:flex;align-items:center;gap:10px
  }
  @media (max-width:760px){.h1{font-size:22px}}

  .desc{margin-top:8px;color:var(--muted);font-size:13px;line-height:1.35}

  .badge{
    display:inline-flex;align-items:center;gap:10px;
    padding:10px 14px;border-radius:999px;
    border:1px solid var(--borderStrong);
    background:var(--tile);
    font-weight:950;
    white-space:nowrap;
  }
  .badgeDot{width:10px;height:10px;border-radius:99px;background:#22c55e;display:inline-block}

  /* ===== Card body fills remaining space ===== */
  .card-body{
    position:relative;
    flex:1;
    display:flex;
    flex-direction:column;
    min-height:0;
    background:transparent;
  }

  /* ===== HubSpot container fills all available height ===== */
  #hsMount{
    width:100%;
    flex:1;
    position:relative;
    overflow:hidden;
    display:flex;
    flex-direction:column;
  }

  /* HubSpot inline parent - force full height */
  #hubspot-conversations-inline-parent{
    width:100% !important;
    flex:1 !important;
    position:relative !important;
    display:flex !important;
    flex-direction:column !important;
  }

  /* HubSpot iframe - force full height */
  #hubspot-conversations-inline-iframe{
    width:100% !important;
    flex:1 !important;
    min-height:100% !important;
    border:0 !important;
    display:block !important;
    background:transparent !important;
  }

  /* Hide HubSpot promotional banner (best-effort) */
  #hubspot-conversations-inline-parent [class*="promo"],
  #hubspot-conversations-inline-parent [class*="banner"],
  #hubspot-conversations-inline-parent [class*="upgrade"],
  #hubspot-conversations-inline-parent a[href*="hubspot.com"]{
    display:none !important;
  }

  /* ✅ NEW: bottom mask that covers “Add live chat...” */
  #hsBrandMask{
    position:absolute;
    left:0; right:0; bottom:0;
    height:calc(var(--hs-mask-h) + env(safe-area-inset-bottom, 0px));
    z-index:50;
    pointer-events:none; /* doesn't block typing */
    background:linear-gradient(
      180deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.72) 0%,
      rgba(255,255,255,.92) 0%
    );
  }
  body.dark #hsBrandMask{
    background:linear-gradient(
      180deg,
      rgba(0,0,0,0) 0%,
      rgba(21,21,23,.55) 0%,
      rgba(21,21,23,.88) 0%
    );
  }

  /* Clean fallback (only shows if blocked) */
  #fallback{
    display:none;
    padding:18px;
    position:absolute;
    inset:0;
    background:var(--panel);
    z-index:10;
  }
  #fallback.show{display:block}
  .fallbackBox{
    max-width:560px;margin:0 auto;
    background:var(--tile);
    border:1px solid var(--borderStrong);
    border-radius:18px;
    padding:16px;
    box-shadow:0 10px 28px rgba(15,23,42,.08);
  }
  .fbTitle{margin:0 0 6px;font-weight:1000}
  .fbText{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
  .fbBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .fbBtn{
    height:42px;padding:0 14px;border-radius:999px;border:1.5px solid var(--borderStrong);
    background:#fff;color:#111;font-weight:1000;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
    text-decoration:none;
    touch-action:manipulation;
    -webkit-tap-highlight-color:transparent;
  }
  body.dark .fbBtn{background:#111;color:#fff}
  .fbBtn.primary{border-color:var(--accent);color:var(--accent);background:transparent}

  /* Mobile sheet */
  #sheet{position:fixed;inset:0;z-index:9999;display:none}
  #sheet.open{display:block}
  #sheet .back{position:absolute;inset:0;background:rgba(0,0,0,.42);backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px)}
  #sheet .panel{
    position:absolute;right:0;top:0;height:100%;width:min(86vw,360px);
    background:rgba(255,255,255,.92);
    border-left:1px solid rgba(15,23,42,.18);
    box-shadow:var(--shadow);
    padding:16px;display:flex;flex-direction:column;gap:14px;
    backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(var(--glass-sat));
    transform:translateX(100%);transition:transform .22s ease-out;will-change:transform;
    padding-bottom:calc(16px + env(safe-area-inset-bottom, 0px));
  }
  body.dark #sheet .panel{background:rgba(21,21,23,.92);border-left:1px solid rgba(255,255,255,.20)}
  #sheet.open .panel{transform:translateX(0)}
  .sheetTitle{font-weight:1000;font-size:16px;margin:2px 0 0}
  .sheetSub{color:var(--muted);font-size:12px;margin:0}
  .sheetBtns{display:grid;gap:10px;margin-top:8px}
  .sheetBtns .chip{width:100%;justify-content:center;height:44px}
  .sheetCloseRow{display:flex;justify-content:space-between;align-items:center}
  .xbtn{
    height:38px;min-width:38px;border-radius:999px;border:1.5px solid var(--borderStrong);
    background:var(--tile);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;
    touch-action:manipulation;
    -webkit-tap-highlight-color:transparent;
  }
  .xbtn svg{width:18px;height:18px;stroke-width:2.6}

  /* Mobile-specific util classes added via JS */
  body.sheet-open{overflow:hidden;position:fixed;width:100%;height:100%;}
</style>

<script>
  const HS_PORTAL_ID = "342895404";
  const HS_HUBLET = "na3";

  // IMPORTANT: inline embed for ALL devices (mobile too)
  window.hsConversationsSettings = {
    inlineEmbedSelector: "#hsMount",
    loadImmediately: true
  };

  function hsReady(){
    return !!(window.HubSpotConversations && window.HubSpotConversations.widget);
  }

  function setTheme(next){
    document.body.classList.toggle("dark", next==="dark");
    localStorage.setItem("bfa_support_theme", next);
  }
  function initTheme(){
    const saved = localStorage.getItem("bfa_support_theme");
    if (saved) setTheme(saved);
    else if (window.matchMedia && matchMedia("(prefers-color-scheme: dark)").matches) setTheme("dark");
  }

  function loadScriptWithFallback(urls){
    return new Promise((resolve,reject)=>{
      let i = 0;
      const tryNext = () => {
        if (i >= urls.length) return reject(new Error("HubSpot script blocked"));
        const src = urls[i++].trim();
        const s = document.createElement("script");
        s.async = true; s.defer = true; s.src = src;
        s.onload = () => resolve(src);
        s.onerror = () => tryNext();
        document.head.appendChild(s);
      };
      tryNext();
    });
  }

  // Force HubSpot to fill container
  function forceHubSpotFullHeight() {
    const promoBanners = document.querySelectorAll(
      '#hubspot-conversations-inline-parent [class*="promo"], ' +
      '#hubspot-conversations-inline-parent [class*="banner"], ' +
      '#hubspot-conversations-inline-parent a[href*="hubspot.com"]'
    );
    promoBanners.forEach(el => el.remove());

    const iframe = document.querySelector('#hubspot-conversations-inline-iframe');
    if (iframe) {
      iframe.style.height = '100%';
      iframe.style.minHeight = '100%';
    }

    const parent = document.querySelector('#hubspot-conversations-inline-parent');
    if (parent) {
      parent.style.height = '100%';
      parent.style.display = 'flex';
      parent.style.flexDirection = 'column';
    }
  }

  async function bootHubSpot(){
    const urls = [
      `https://js-${HS_HUBLET}.hs-scripts.com/${HS_PORTAL_ID}.js`,
      `https://js.hs-scripts.com/${HS_PORTAL_ID}.js`
    ];

    try{
      await loadScriptWithFallback(urls);

      const start = Date.now();
      while (!hsReady() && Date.now() - start < 12000){
        await new Promise(r=>setTimeout(r, 200));
      }

      if (!hsReady()){
        document.getElementById("fallback").classList.add("show");
        document.getElementById("fbText").textContent =
          "HubSpot loaded, but the chat didn't initialize. In HubSpot, confirm this chatflow is ON and allowed for this domain.";
        return;
      }

      setTimeout(forceHubSpotFullHeight, 500);
      setTimeout(forceHubSpotFullHeight, 1500);

      const observer = new MutationObserver(() => {
        forceHubSpotFullHeight();
      });

      const mount = document.getElementById('hsMount');
      if (mount) {
        observer.observe(mount, { childList: true, subtree: true });
      }

      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(forceHubSpotFullHeight, 250);
      });

      document.addEventListener("visibilitychange", ()=>{
        if (!document.hidden){
          setTimeout(forceHubSpotFullHeight, 300);
        }
      });

    }catch(e){
      document.getElementById("fallback").classList.add("show");
      document.getElementById("fbText").textContent =
        "HubSpot is being blocked on this phone/network (very common with iOS privacy/DNS/adblock). Disable blockers or use Email/WhatsApp below.";
    }
  }

  function retryChat(){
    if (!hsReady()) return;
    try{
      window.HubSpotConversations.widget.refresh({ openToNewThread:false });
      setTimeout(forceHubSpotFullHeight, 500);
    }catch(e){}
  }

  function newChat(){
    if (!hsReady()) return;
    try{
      window.HubSpotConversations.clear({ resetWidget:true });
    }catch(e){}
    setTimeout(()=>{
      retryChat();
      setTimeout(forceHubSpotFullHeight, 500);
    }, 300);
  }

  function openSheet(){
    document.getElementById("sheet").classList.add("open");
    document.body.classList.add("sheet-open");
    document.getElementById("sheet").setAttribute("aria-hidden", "false");
  }
  function closeSheet(){
    document.getElementById("sheet").classList.remove("open");
    document.body.classList.remove("sheet-open");
    document.getElementById("sheet").setAttribute("aria-hidden", "true");
  }

  function setVH() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  window.addEventListener('resize', setVH);
  window.addEventListener('orientationchange', () => {
    setTimeout(setVH, 100);
    setTimeout(() => {
      retryChat();
      forceHubSpotFullHeight();
    }, 300);
  });
  setVH();

  document.addEventListener("DOMContentLoaded", ()=>{
    initTheme();
    bootHubSpot();

    document.getElementById("btnNew").addEventListener("click", newChat);
    document.getElementById("btnRetry").addEventListener("click", retryChat);
    document.getElementById("btnTheme").addEventListener("click", ()=>{
      setTheme(document.body.classList.contains("dark") ? "light" : "dark");
    });

    document.getElementById("hamburger").addEventListener("click", (e) => {
      e.preventDefault();
      openSheet();
    });
    document.getElementById("sheetBack").addEventListener("click", closeSheet);
    document.getElementById("sheetClose").addEventListener("click", closeSheet);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && document.getElementById("sheet").classList.contains('open')) {
        closeSheet();
      }
    });

    document.getElementById("sheetNew").addEventListener("click", ()=>{ closeSheet(); newChat(); });
    document.getElementById("sheetRetry").addEventListener("click", ()=>{ closeSheet(); retryChat(); });
    document.getElementById("sheetTheme").addEventListener("click", ()=>{
      closeSheet();
      setTheme(document.body.classList.contains("dark") ? "light" : "dark");
    });

    const buttons = document.querySelectorAll('button, .chip');
    buttons.forEach(btn => {
      btn.addEventListener('touchend', (e) => {
        e.preventDefault();
        btn.click();
      }, {passive: false});
    });
  });
</script>
</head>

<body>
  <div class="topbar">
    <div class="toprow">
      <div class="brand">
        <div class="logo" style="background-image:url('/IPTV-/icons/icon-192.png')"></div>
        <div class="logotxt">BFA Support</div>
      </div>

      <div class="actions">
        <button class="chip" id="btnNew" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14"/></svg>
          New
        </button>
        <button class="chip" id="btnRetry" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/></svg>
          Retry
        </button>
        <button class="chip accent" id="btnTheme" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.8A9 9 0 1 1 11.2 3a7 7 0 0 0 9.8 9.8Z"/></svg>
          Theme
        </button>
      </div>

      <button id="hamburger" type="button" aria-label="Menu">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 7h16M4 12h16M4 17h16"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="card-head">
        <div class="hgroup">
          <div class="h1">
            Live Chat Digital Signage (TV) Tech Support
            <svg class="ic" viewBox="0 0 24 24" aria-hidden="true" style="stroke:var(--accent)">
              <path d="M4 12a8 8 0 0 1 16 0v5a2 2 0 0 1-2 2h-2"/>
              <path d="M4 12v5a2 2 0 0 0 2 2h2"/>
              <path d="M8 19a4 4 0 0 0 4 2h2"/>
            </svg>
          </div>
          <div class="desc">
            We usually reply quickly during business hours.
          </div>
        </div>
        <div class="badge">
          <span class="badgeDot"></span>
          Support Online
        </div>
      </div>

      <div class="card-body">
        <div id="hsMount"></div>

        <!-- ✅ NEW: covers the “Add live chat...” promo line without blocking the input -->
        <div id="hsBrandMask" aria-hidden="true"></div>

        <div id="fallback">
          <div class="fallbackBox">
            <p class="fbTitle">Chat couldn't load</p>
            <p class="fbText" id="fbText">HubSpot is being blocked on this phone/network.</p>
            <div class="fbBtns">
              <a class="fbBtn primary" href="mailto:garth@thebfagroup.com">Email Support</a>
              <a class="fbBtn" href="https://wa.me/16472090519" target="_blank" rel="noopener">WhatsApp</a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="sheet" aria-hidden="true">
    <div class="back" id="sheetBack"></div>
    <div class="panel" role="dialog" aria-label="Menu">
      <div class="sheetCloseRow">
        <div>
          <div class="sheetTitle">BFA Support</div>
          <p class="sheetSub">Quick actions</p>
        </div>
        <button class="xbtn" id="sheetClose" type="button" aria-label="Close menu">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" fill="none"/>
          </svg>
        </button>
      </div>

      <div class="sheetBtns">
        <button class="chip" id="sheetNew" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14"/></svg>
          New chat
        </button>
        <button class="chip" id="sheetRetry" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-2.64-6.36"/><path d="M21 3v6h-6"/></svg>
          Retry
        </button>
        <button class="chip accent" id="sheetTheme" type="button">
          <svg class="ic" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.8A9 9 0 1 1 11.2 3a7 7 0 0 0 9.8 9.8Z"/></svg>
          Theme
        </button>
      </div>
    </div>
  </div>
</body>
</html>
